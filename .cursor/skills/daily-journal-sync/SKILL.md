---
description: 工作日記驅動更新系統 - 自動同步工作報告到核心文件，維護雙向連結，建議歸檔舊報告
tags: [obsidian, workflow, automation, sync]
version: 1.0.0
---

# Daily Journal Sync Skill

## Description

這個 Skill 實現「工作日記驅動更新」邏輯，確保工作報告（Daily Journal）與核心文件（Tier 1）保持同步。它會：
1. 讀取最新工作報告
2. 分析受影響的核心文件
3. 驗證雙向連結完整性
4. 建議需要更新的內容
5. 檢測並建議歸檔舊報告

## When to Use

### 自動觸發場景
- 用戶完成工作報告後
- 用戶請求同步工作進度時
- 準備 Git commit 前的檢查

### 手動觸發指令
- `/sync-journal` - 同步最新工作報告
- `/check-journal` - 檢查工作報告完整性
- `/archive-old-journals` - 檢查可歸檔的舊報告

### 適用情境
- ✅ 每次完成工作報告後
- ✅ 更新核心文件前，檢查是否有遺漏
- ✅ 定期維護時（每週/每月）
- ✅ Git commit 前的完整性檢查

## How It Works

### 步驟 1：掃描最新工作報告

```
1. 讀取 `00-工作區/` 目錄
2. 找到所有 `工作報告_YYYY-MM-DD_*.md` 文件
3. 按日期排序，取得最新的 1-3 份報告
4. 解析報告內容，提取關鍵資訊
```

**提取內容**：
- 報告日期
- 完成的任務
- 受影響的核心文件列表
- 所有 Wikilinks `[[文件名]]`

### 步驟 2：分析受影響的 Tier 1 文件

**Tier 1 核心文件清單**：
1. `00-核心企劃/當前專案_靈魂食堂/靈魂食堂：最終開發執行企劃書.md` - 專案全貌
2. `00-工作區/主 Backlog_2026-01-15.md` - 任務清單
3. `01-開發實驗/專案實作對照表.md` - 代碼映射
4. `00-核心企劃/開發決策鏈.md` - 決策記錄

**分析邏輯**：
```
FOR EACH 工作報告中的 Wikilink:
  IF 連結目標是 Tier 1 文件:
    檢查該文件是否需要更新
    驗證雙向連結是否存在
  END IF
END FOR
```

### 步驟 3：驗證雙向連結

**檢查清單**：
1. ✅ 工作報告是否包含 `🔗 受影響的核心文件` 區塊？
2. ✅ 每個 Tier 1 文件是否反向連結到這份工作報告？
3. ✅ 連結路徑是否使用相對路徑？
4. ✅ 連結是否有效（目標文件存在）？

**雙向連結範例**：
```markdown
# 工作報告_2026-01-22_文件整理完成.md
## 🔗 受影響的核心文件
- [[主 Backlog_2026-01-15]] - 更新任務狀態
- [[靈魂食堂：最終開發執行企劃書]] - 更新至 V4.3

# 主 Backlog_2026-01-15.md
> **參考文件**：[[工作報告_2026-01-22_文件整理完成]]
```

### 步驟 4：生成更新建議

**建議類型**：

#### A. Tier 1 文件需要更新
```markdown
## 📝 建議更新

### 主 Backlog_2026-01-15.md
- [ ] 更新任務狀態：Day 1 動態系統 → 已完成 ✅
- [ ] 新增任務：Day 2-3 動態系統擴展
- [ ] 更新代碼行數：~3,288 → ~3,488 行

### 靈魂食堂：最終開發執行企劃書.md
- [ ] 新增章節：「動態話題系統原則」
- [ ] 更新版本號：V4.2 → V4.3
- [ ] 記錄重大突破：多次對話收集食材系統
```

#### B. 缺少雙向連結
```markdown
## ⚠️ 缺少雙向連結

### 主 Backlog_2026-01-15.md
建議在文件頂部添加：
> **參考文件**：[[工作報告_2026-01-21_UX全面改進]] | [[工作報告_2026-01-22_文件整理完成]]
```

#### C. 連結格式問題
```markdown
## 🔧 連結格式修正

### 工作報告_2026-01-20.md
- 第 6 行：`[[架構診斷報告_2026-01-15]]`
  建議改為：`[[../00-工作區/架構診斷報告_2026-01-15]]`（使用相對路徑）
```

### 步驟 5：檢測可歸檔的舊報告

**歸檔規則**：
- 工作報告超過 **7 天**
- 目標目錄：`00-工作區/archive-YYYY-MM/`

**檢測流程**：
```
1. 讀取所有工作報告的日期
2. 計算與今日的天數差
3. 找出超過 7 天的報告
4. 生成歸檔建議清單
5. 檢查是否有其他文件引用這些報告
6. 建議更新所有引用連結
```

**歸檔建議範例**：
```markdown
## 🗄️ 可歸檔的舊報告

以下報告已超過 7 天，建議歸檔：

1. `工作報告_2026-01-15_架構診斷.md`（8 天前）
   - 目標路徑：`archive-2026-01/`
   - 引用此報告的文件：
     - `主 Backlog_2026-01-15.md`（第 6 行）
     - `架構診斷報告_2026-01-15.md`（第 10 行）
   - 需要更新的連結：2 處

2. `工作報告_2026-01-16_重構完成.md`（7 天前）
   - 目標路徑：`archive-2026-01/`
   - 引用此報告的文件：無
   - 可直接歸檔 ✅
```

### 步驟 6：執行自動化操作（可選）

**安全模式**（預設）：
- 僅生成建議報告
- 不自動修改任何文件
- 需要用戶確認後再執行

**自動模式**（需明確啟用）：
- 自動更新雙向連結
- 自動移動舊報告到歸檔目錄
- 自動更新所有引用連結
- 生成變更記錄

## Examples

### Example 1：完成工作報告後同步

**場景**：用戶剛完成 `工作報告_2026-01-23_Day2動態系統完成.md`

**使用方式**：
```
用戶：我剛完成今天的工作報告，請幫我同步到核心文件。
AI：好的，讓我幫你同步工作報告。
```

**Skill 執行流程**：
```
1. 讀取 `工作報告_2026-01-23_Day2動態系統完成.md`
2. 提取受影響的文件：
   - 主 Backlog_2026-01-15.md
   - 靈魂食堂：最終開發執行企劃書.md
3. 檢查雙向連結（發現缺少）
4. 生成更新建議：
   - 更新 Backlog 的任務狀態
   - 更新企劃書的版本號
   - 添加雙向連結
5. 檢查歸檔需求（發現 1 份舊報告）
6. 輸出完整報告
```

**輸出範例**：
```markdown
# 工作報告同步結果

## ✅ 最新工作報告
- 工作報告_2026-01-23_Day2動態系統完成.md
- 日期：2026-01-23
- 受影響文件：2 個

## 📝 建議更新

### 主 Backlog_2026-01-15.md
- [ ] 更新任務狀態：Day 2-3 動態系統 → 已完成 ✅
- [ ] 新增反向連結：[[工作報告_2026-01-23_Day2動態系統完成]]

### 靈魂食堂：最終開發執行企劃書.md
- [ ] 更新版本號：V4.3 → V4.4
- [ ] 新增 Day 2 動態系統說明

## 🗄️ 可歸檔報告
- 工作報告_2026-01-16_重構完成.md（8 天前）

是否執行這些更新？
```

### Example 2：準備 Git Commit 前檢查

**場景**：用戶準備提交代碼，想確保所有文件同步

**使用方式**：
```
用戶：我要準備 commit 了，請檢查工作報告是否同步。
AI：好的，讓我檢查最近的工作報告。
```

**Skill 執行流程**：
```
1. 讀取最近 3 份工作報告
2. 逐一檢查每份報告的同步狀態
3. 驗證所有雙向連結
4. 檢查是否有未更新的 Tier 1 文件
5. 生成完整性報告
```

**輸出範例**：
```markdown
# 工作報告完整性檢查

## 📋 最近 3 份報告

1. ✅ 工作報告_2026-01-23_Day2動態系統完成.md（已同步）
2. ⚠️ 工作報告_2026-01-22_文件整理完成.md（部分同步）
3. ✅ 工作報告_2026-01-21_UX全面改進.md（已同步）

## ⚠️ 發現問題

### 工作報告_2026-01-22_文件整理完成.md
- 缺少雙向連結：`PROJECT_ARCHITECTURE.md` 沒有反向連結

## 建議
- [ ] 在 `PROJECT_ARCHITECTURE.md` 添加反向連結
- [ ] 檢查歸檔需求（有 2 份舊報告）

所有問題修正後可安全 commit。
```

### Example 3：定期維護（每週檢查）

**場景**：每週日檢查並整理工作報告

**使用方式**：
```
用戶：幫我整理這週的工作報告。
AI：好的，讓我檢查這週的所有工作報告並建議歸檔。
```

**Skill 執行流程**：
```
1. 讀取最近 7 天的工作報告
2. 檢查每份報告的同步狀態
3. 生成週報總結
4. 識別所有超過 7 天的報告
5. 建議批量歸檔
```

**輸出範例**：
```markdown
# 本週工作報告總結（2026-01-17 ~ 2026-01-23）

## 📊 本週報告（7 份）

1. 2026-01-23：Day 2 動態系統完成
2. 2026-01-22：文件整理完成
3. 2026-01-21：UX 全面改進
4. 2026-01-20：田中太郎版實裝
5. 2026-01-19：劇本深化完成
6. 2026-01-18：畫鬼腳 MVP 完成
7. 2026-01-17：架構重構完成

## 🗄️ 建議歸檔（5 份）

以下報告超過 7 天，建議歸檔到 `archive-2026-01/`：
- 工作報告_2026-01-10_*.md
- 工作報告_2026-01-11_*.md
- 工作報告_2026-01-12_*.md
- 工作報告_2026-01-13_*.md
- 工作報告_2026-01-14_*.md

## 📝 核心文件更新狀態

- ✅ 主 Backlog：最後更新 2026-01-22
- ✅ 企劃書：最後更新 2026-01-22（V4.3）
- ⚠️ 專案實作對照表：最後更新 2026-01-20（建議更新）

是否執行批量歸檔？
```

## Dependencies

### 必須的文件
1. `00-工作區/` 目錄（存放工作報告）
2. Tier 1 核心文件：
   - `00-核心企劃/當前專案_靈魂食堂/靈魂食堂：最終開發執行企劃書.md`
   - `00-工作區/主 Backlog_2026-01-15.md`
   - `01-開發實驗/專案實作對照表.md`
   - `00-核心企劃/開發決策鏈.md`

### 必須的規則
1. `obsidian-linking.mdc` Rule（Obsidian 連結規範）

### 建議搭配的 Skills
1. `obsidian-link-validator` Skill（連結驗證）
2. `archive-detector` Skill（歸檔檢測）

## Notes

### 重要提醒

1. **安全優先**：預設僅生成建議，不自動修改文件
2. **人工確認**：任何自動更新都應該經過用戶確認
3. **備份機制**：執行批量操作前建議先 Git commit
4. **相對路徑**：所有連結必須使用相對路徑格式
5. **日期格式**：工作報告必須使用 `YYYY-MM-DD` 格式

### 工作報告命名規範

**標準格式**：
```
工作報告_YYYY-MM-DD_主題.md
```

**範例**：
- ✅ `工作報告_2026-01-22_文件整理完成.md`
- ✅ `工作報告_2026-01-21_UX全面改進.md`
- ❌ `工作報告_20260122_主題.md`（日期格式錯誤）
- ❌ `daily-report.md`（命名不符合規範）

### 工作報告必須包含的區塊

```markdown
# 標題

> **日期**：YYYY-MM-DD  
> **類型**：開發/知識管理/研究  
> **狀態**：進行中/已完成

## ✅ 已完成
- 任務 1
- 任務 2

## 🔄 進行中
- 任務 3

## 🔗 受影響的核心文件
- [[主 Backlog_2026-01-15]] - 更新內容說明
- [[靈魂食堂：最終開發執行企劃書]] - 更新內容說明
```

### 歸檔目錄結構

```
00-工作區/
├── 工作報告_2026-01-22_文件整理完成.md  # 最新（保留）
├── 工作報告_2026-01-21_UX全面改進.md     # 最新（保留）
└── archive-2026-01/                      # 歸檔目錄
    ├── 工作報告_2026-01-15_*.md          # 舊報告
    ├── 工作報告_2026-01-16_*.md
    └── 工作報告_2026-01-17_*.md
```

### Tier 系統說明

**Tier 1：核心真理源**（必須同步）
- 專案全貌、任務清單、代碼映射、決策記錄

**Tier 2：動態追蹤**（工作報告屬於此層）
- 每日/每週更新，記錄當前進度

**Tier 3：參考資料**（較少變動）
- 代碼、劇本、研究分析

**Tier 4：歷史歸檔**（長期保存）
- 過時但有歷史價值的文件

### 常見問題

**Q1：如何判斷 Tier 1 文件是否需要更新？**
A：檢查工作報告中提到的變更內容是否已反映在 Tier 1 文件中。

**Q2：工作報告多久歸檔一次？**
A：超過 7 天的報告建議歸檔，但可根據專案需求調整。

**Q3：歸檔後的連結如何更新？**
A：所有指向歸檔報告的連結都需要更新為新的相對路徑。

**Q4：如果工作報告沒有 `🔗 受影響的核心文件` 區塊怎麼辦？**
A：Skill 會自動掃描所有 Wikilinks，提醒用戶添加此區塊。

**Q5：可以自動執行更新嗎？**
A：可以，但需要明確啟用「自動模式」，並建議先備份（Git commit）。

## Workflow Integration

### 理想的工作流程

```
1. 完成今日工作
2. 撰寫工作報告（包含 🔗 受影響的核心文件）
3. 運行 /sync-journal
4. 根據建議更新 Tier 1 文件
5. 驗證雙向連結完整性
6. Git commit（包含工作報告 + 核心文件更新）
7. 每週日運行 /archive-old-journals
8. 批量歸檔舊報告
```

### 與 Git 的整合

**建議的 Commit Message 格式**：
```
docs: 更新工作報告 + 核心文件同步 (2026-01-23)

- 新增工作報告：Day 2 動態系統完成
- 更新主 Backlog：任務狀態 + 代碼行數
- 更新企劃書：V4.3 → V4.4
- 歸檔 5 份舊報告到 archive-2026-01/
```

## Version History

- **1.0.0** (2026-01-23)：初版 Skill 建立
  - 工作報告讀取與分析
  - Tier 1 文件同步檢查
  - 雙向連結驗證
  - 歸檔建議生成
