# 主 Backlog：靈魂食堂專案任務清單

> **最後更新**：2026-01-18  
> **當前 Sprint**：緊急重構週（Week 3, Jan 2026）  
> **專案狀態**：✅ 畫鬼腳 MVP 測試版部署完成  
> **參考文件**：[[架構診斷報告_2026-01-15]] | [[工作報告_2026-01-18]]

---

## 🔴 P0：本週必做（架構穩定化）

### ✅ 已完成
- [x] 深度診斷與架構分析
- [x] 建立開發決策鏈文件
- [x] 建立靈魂考古 3 日邏輯鏈
- [x] 建立專案實作對照表
- [x] 拆解 AI 對談紀錄為原子筆記
- [x] **重構程式碼.gs：實作 6 欄位數據結構**（✅ 2026-01-16 完成）
  - [x] 實作 `getUserState()` 與 `saveUserState()` 函數（支援 JSON 陣列）
  - [x] 6 欄位結構：userId, currentDay, currentMood, collectedTags (JSON), lastActive, phase
  - [x] 新玩家初始化時 `collectedTags` 為空陣列 `[]`
  - [x] `collectedTags` 持久化為 JSON 字串格式
- [x] **實作跨日鎖定機制**（✅ 2026-01-16 完成）
  - [x] 新增 `canProgress()` 函數（黃昏旅店機制）
  - [x] 在 `doPost()` 開頭強制檢查
  - [x] 實作 `IS_DEBUG_MODE` 開關（測試時可跳過檢查）
  - [x] 自動跨日推進邏輯（日期變更時自動 `currentDay += 1`）
- [x] **實作標籤持久化機制**（✅ 2026-01-16 完成）
  - [x] 聊天選擇累加存入 `collectedTags`，不覆蓋舊標籤
  - [x] 標籤格式：`{mood}_{choice}`（如 `Sweet_全部拌在一起！`）
  - [x] 去重機制（避免重複標籤）
- [x] **實作動態台詞檢索**（✅ 2026-01-16 完成）
  - [x] `findDialogue()` 函數根據 `(day, mood, phase)` 複合條件檢索
  - [x] 支援多層級 fallback 機制（完全匹配 → 部分匹配 → 預設）
- [x] **畫鬼腳 MVP 測試版部署**（✅ 2026-01-18 完成）
  - [x] 建立簡化版測試模型（3 天 × 3 選項 = 9 結局）
  - [x] LINE Bot + Google Sheets 整合
  - [x] Flex Message 卡片 UI
  - [x] Quick Reply 按鈕選項
  - [x] 用戶狀態讀寫（pathCode 追蹤）
  - [x] 完整流程測試通過（Day 1 → Day 2 → Day 3 結局）
  - **檔案**：`01-開發實驗/程式碼/靈魂食堂_畫鬼腳MVP.gs`

### 🔄 進行中
- [ ] **撰寫 Mr. Needle 完整文本**（預估 2hr）← **當前 P0 優先任務**
  - [ ] 生成 9 個結局的完整文案
  - [ ] 生成所有 Flex Message JSON
  - [ ] 建立測試檢查清單
  - [ ] 討論標籤如何影響對話內容
  - **負責人**：企劃 + 開發
  - **截止日**：2026-01-19

---

## 🟠 P1：下週完成（功能完整化）

- [ ] **優化標籤驅動對話邏輯**（預估 2hr）← **已基本實作，待優化**
  - [x] ✅ 基本框架已完成（`findDialogue()` 已實作）
  - [ ] 實作標籤組合邏輯（`["warmth", "softness"]` → 特定劇情）
  - [ ] 擴展 `dialogueLibrary` 支援 `required_tags` 欄位
  - [ ] 測試 5 種標籤組合的分支
  - **負責人**：開發者
  - **截止日**：2026-01-20

- [ ] **設計 Flex Message 模板**（預估 2hr）
  - [ ] 人物卡模板（靈魂進場）
  - [ ] 記憶劇場模板（Carousel）
  - [ ] 遺物卡模板（超渡後）
  - [ ] 使用 LINE Flex Simulator 測試
  - **負責人**：開發者
  - **截止日**：2026-01-21

- [ ] **建立 Guest 2 劇本**（預估 4hr）
  - [ ] 設計「離婚的鹹味記憶」故事線
  - [ ] 填入 dialogueLibrary
  - [ ] 驗證系統支援多靈魂切換
  - **負責人**：企劃
  - **截止日**：2026-01-22

---

## 🟡 P2：兩週內完成（體驗優化）

- [ ] **實作 LIFF 烹飪小遊戲原型**（預估 6hr）
  - [ ] 設計拖曳食材介面
  - [ ] 實作合成驗證邏輯
  - [ ] **或**使用 Quick Reply 簡化版（如果 LIFF 太複雜）
  - **負責人**：開發者
  - **截止日**：2026-01-28

- [ ] **設計 Rich Menu 狀態機**（預估 2hr）
  - [ ] 大廳模式（接待客人/前往廚房/圖鑑）
  - [ ] 對話模式（詢問/給予/觀察）
  - [ ] 廚房模式（食材庫/開始烹飪）
  - **負責人**：開發者
  - **截止日**：2026-01-29

- [ ] **進行封閉測試**（預估 8hr）
  - [ ] 招募 5-10 名測試者
  - [ ] 進行「人肉 Bot」測試（開發者手動回覆）
  - [ ] 收集反饋：情感體驗、卡點、建議
  - [ ] 迭代劇本與互動流程
  - **負責人**：全員
  - **截止日**：2026-02-01

---

## 🔵 P3：長期規劃（規模化準備）

- [ ] **建立遺物系統**
  - [ ] 設計「圖鑑」介面（Flex Message）
  - [ ] 實作遺物收藏邏輯
  - [ ] 設計「分享遺物卡片」功能（社交傳播）

- [ ] **設計隱藏靈魂解鎖機制**
  - [ ] 完成 3 位靈魂 → 解鎖「老闆的秘密」
  - [ ] 設計元敘事劇情（食堂的真相）

- [ ] **優化 LIFF 視覺體驗**
  - [ ] 設計食堂外觀（根據玩家情緒變化）
  - [ ] 添加 BGM 與音效

- [ ] **建立數據分析儀表板**
  - [ ] 追蹤玩家完成率、流失點
  - [ ] 分析最受歡迎的靈魂故事
  - [ ] 優化劇本與難度曲線

---

## 🗂️ 待歸檔的舊任務（已不適用）

以下是從舊 Backlog 中識別出的**已過時任務**，建議歸檔：

### 來自「待辦事項-優化每日推播.md」
- ~~優化雲寶的每日推播內容~~ → **已放棄推播機制**
- ~~設計 7 天的情緒變化曲線~~ → **已改為 3 日結構**

### 來自「待辦事項-問卷更新.md」
- ~~更新陪伴性驗證問卷~~ → **轉型為敘事遊戲後，驗證目標已改變**

**建議**：將這些檔案移動到 `00-工作區/歷史歸檔/` 資料夾。

---

## 📊 Sprint 進度追蹤

### Week 3 (2026-01-15 ~ 2026-01-22)

**目標**：完成架構重構，跑通 Guest 1 的完整流程

| 任務 | 預估 | 實際 | 狀態 | 阻礙 |
|------|------|------|------|------|
| 重構程式碼.gs | 2hr | 2hr | ✅ 已完成 | - |
| 跨日檢查邏輯 | 1hr | 1hr | ✅ 已完成 | - |
| 標籤持久化 | 1hr | 1hr | ✅ 已完成 | - |
| 動態台詞檢索 | 1hr | 1hr | ✅ 已完成 | - |
| **畫鬼腳 MVP** | 4hr | 5hr | ✅ 已完成 | GAS 部署問題（已解決） |
| Mr. Needle 文本 | 2hr | - | 🔄 **進行中** | 待討論 |
| 優化標籤驅動 | 2hr | - | 📋 待開始 | - |

**本週會議**：
- [x] 週三檢查點：確認資料結構重構完成 ✅
- [x] 週六（1/18）：畫鬼腳 MVP 部署完成 ✅
- [ ] 週日（1/19）：完成 Mr. Needle 完整文本

---

## 🚨 風險與阻礙

### 當前風險
1. **技術風險**：跨日邏輯的時區處理
   - **緩解方案**：使用 GAS 伺服器時間，不依賴客戶端
   
2. **資源風險**：劇本撰寫耗時超出預期
   - **緩解方案**：先完成 Guest 1，Guest 2 可延後

3. **測試風險**：難以找到願意測試的受眾
   - **緩解方案**：先進行內部測試（朋友、同事）

---

## 📚 相關文件

- [[架構診斷報告_2026-01-15]] - 本次重構的診斷依據
- [[專案實作對照表]] - 開發時的技術規格
- [[靈魂考古_3日邏輯鏈]] - 劇本設計藍圖
- [[開發決策鏈]] - 理解為何做這些決定

---

**下次更新**：2026-01-22（每週一更新）  
**維護者**：專案負責人
