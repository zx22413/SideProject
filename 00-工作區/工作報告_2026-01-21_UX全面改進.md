# 靈魂食堂 UX 全面改進 - 工作報告

> **日期**：2026-01-21  
> **版本**：v3.0 → **v4.0（動態話題系統）**  
> **狀態**：Day 1 動態系統完成，Day 2-3 待擴展

---

## 📋 今日工作總結

### ✅ 已完成

#### 1. Loading Animation 全面覆蓋
- ✅ 修正 API 格式（URL + payload + loadingSeconds 必須是 5 的倍數）
- ✅ 所有 input 都加入 Loading Animation（35 處）
- ✅ 修正 `advancePhase` 函數

#### 2. Bug 修正（4 個關鍵問題）
- ✅ **Bug 1**：「觀察他」沒有 Loading → 已修正 `advancePhase`
- ✅ **Bug 2**：話題選擇沒有對話形式呈現 → 改用 Message Action
- ✅ **Bug 3**：進入廚房條件過嚴 → 修正為 `topicsDone.length > 0`
- ✅ **Bug 4**：做熱茶卡住 → 修正 return 語句 + 訊息數量限制（6→5條）

#### 3. **Day 1 動態話題系統**（重大突破 🎉）
- ✅ 創建 `getDay1DayShift(state)` 動態函數
  - 根據已完成話題隱藏按鈕
  - 完成話題後顯示「進入廚房」
  - 顯示已收集話題數量
- ✅ 其他話題完成後回到選擇畫面（收集多種食材）
- ✅ 動態顯示廚房食材（`getDay1CookingScene(state)`）
- ✅ 新增三個話題：
  - 你從哪裡來 → 獲得：失憶、迷茫
  - 窗外的雨 → 獲得：雨聲、潮濕
  - 沉默陪伴 → 獲得：寧靜、陪伴

**新流程**：
```
Day Shift 10:00 選擇話題
    ├─ 你的手 → 完整劇情 → 進入廚房
    ├─ 你從哪裡來 → 對話 → 獲得食材 → 回到選擇畫面 ✨
    ├─ 窗外的雨 → 對話 → 獲得食材 → 回到選擇畫面 ✨
    └─ 沉默陪伴 → 對話 → 獲得食材 → 回到選擇畫面 ✨
         ↓
    完成話題後出現「進入廚房」按鈕
         ↓
Cooking Time（顯示所有收集的食材）
```

---

### 🔴 待完成

#### 1. 小 Bug 修正
- [ ] 檢查並修正用戶回報的小 bug

#### 2. Day 2-3 動態系統擴展
- [ ] **Day 2**：改造為動態話題系統
  - [ ] `getDay2DayShift(state)` - 動態話題選擇
  - [ ] 三個話題（那個夢、你在找什麼、你怎麼來的）
  - [ ] 完成後回到選擇畫面
  - [ ] 動態顯示廚房食材
  
- [ ] **Day 3**：優化料理流程
  - [ ] 動態顯示所有收集的記憶食材
  - [ ] 最終料理合成視覺優化

#### 3. 全面測試
- [ ] Day 1-3 完整流程測試
- [ ] 多種話題組合測試
- [ ] 邊緣情況測試

---

## 🎯 核心設計規範

### 動態話題系統原則
1. **多次對話收集**：玩家可選擇多個話題收集不同食材
2. **動態按鈕顯示**：完成的話題自動隱藏
3. **進度可視化**：顯示已收集話題數量
4. **靈活進入廚房**：完成任意話題後可選擇進入廚房
5. **食材動態顯示**：廚房根據收集的食材動態生成內容

### UX 設計原則
- ✅ 訊息分段（30-80 字）
- ✅ Loading Animation（所有 input）
- ✅ Message Action（玩家輸入顯示為綠色）
- ✅ 【】格式（系統指令）
- ✅ Quick Reply（引導下一步）

---

## 📊 代碼變更統計

### 今日修正
| 類別 | 數量 |
|------|------|
| 新增函數 | 2（動態話題系統）|
| 修改函數 | 10+ |
| Bug 修正 | 19 處 |
| Loading Animation | 35 處 |
| 新增行數 | +200 |

**代碼總行數**：~3,488 行

---

## 🔗 相關文件

### 代碼文件
- `01-開發實驗/程式碼/靈魂食堂_田中太郎重構版.gs`：主代碼（3488 行）

---

## 🎯 下一步行動

### 立即行動（明日繼續）
1. **測試 Day 1 動態系統**：確認所有流程正常
2. **修正用戶回報的小 Bug**
3. **擴展到 Day 2-3**：複製 Day 1 的動態系統模式

### 中期計劃
1. Rich Menu 設計與實作
2. 記憶卡片圖片化
3. 更多靈魂劇本（Guest 2-3）

---

**報告人**：AI Assistant  
**報告時間**：2026-01-22 21:00  
**狀態**：✅ Day 1 動態系統完成，準備擴展到其他天數  
**優先級**：P0 - Day 2-3 動態系統擴展

---

## 💡 關鍵突破

**動態話題系統**是今日最重要的突破！它解決了：
1. ✅ 玩家只能選一個話題的限制
2. ✅ 食材收集單一化的問題
3. ✅ 重玩價值低的問題（現在可以嘗試不同組合）
4. ✅ 流程過於線性的問題（現在更像開放世界）

這套系統可以直接複製到 Day 2-3，大幅提升遊戲深度！🚀

