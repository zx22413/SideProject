# 靈魂食堂：最終開發執行企劃書

> **專案代號**: CONFITEOR  
> **版本**: V4.1 (重構版)  
> **最後更新**: 2026-01-19  
> **狀態**: ✅ 劇本完成，準備實裝

---

## 📋 文件導航

本文件是**靈魂食堂專案的唯一真理來源 (Single Source of Truth)**。  
所有開發、設計、測試決策均應參考此文件。

### 核心文件連結

1. [[靈魂食堂企劃重構|完整世界觀與機制]] - 來自研究分析的完整企劃
2. [[專案實作對照表|技術實作映射]] - 企劃與代碼的橋樑
3. [[主 Backlog_2026-01-15|當前任務清單]] - P0/P1/P2 優先級
4. [[架構診斷報告_2026-01-15|架構健檢報告]] - 轉型斷層分析
5. [[開發決策鏈|決策考古學]] - 為何從雲寶演變至此

---

## 🎯 專案核心定位

### 從「雲寶」到「靈魂食堂」的進化

| 維度       | 雲寶 (V1.0-V1.4) | 靈魂食堂 (V4.0)        |
| -------- | -------------- | ------------------ |
| **角色**   | 電子寵物           | 罪名吞噬者 (Sin-Eater)  |
| **玩家目標** | 養成陪伴           | 救贖超渡               |
| **核心玩法** | 餵食 + 聊天        | 五味診斷 + 標籤考古 + 料理治癒 |
| **時間結構** | 7 日循環          | 3 日儀式 + 跨日鎖定       |
| **情感主題** | 孤獨陪伴           | 見證告別               |
| **重玩性**  | 低 (單一角色)       | 高 (多位靈魂、不同結局)      |

---

## 🌍 世界觀：CONFITEOR 邊境食堂

### 核心設定

**地點**: 生與死交界的虛空邊境  
**建築**: 西多會修道院風格的食堂,永恆雨幕籠罩  
**玩家身份**: 罪名吞噬者 (CONFITEOR,拉丁語「我告解」)  
**職責**: 通過料理喚醒靈魂記憶,助其解開執念並前往來世

### 視覺風格

- **外觀**: 哥德式深色調 (黑、深褐、鐵灰)
- **食物**: 吉卜力風格高飽和度、高光澤
- **對比**: 窗外虛空寒冷 vs. 室內爐火溫暖
- **核心元素**: 
  - 格柵 (告解室結構,隔開廚房與用餐區)
  - 藍色爐火 (煉獄之火,提煉情感)
  - 彩色玻璃窗 (繪製食材圖騰而非聖人)

參考: [[../../02-研究分析/靈魂食堂企劃重構#第二部分：邊境食堂世界觀|企劃重構 P.55-112]]

---

## ⚙️ 核心機制：五味考古系統

### 一、五味映射表 (中醫五行 × 神經美食學)

| 風味    | 五行  | 對應臟器 | 治療的負面情緒 | 敘事功能                  | 適用情境     |
| ----- | --- | ---- | ------- | --------------------- | -------- |
| **甜** | 土   | 脾/胃  | 焦慮、匱乏感  | 撫慰與接地 (Grounding)     | 驚魂未定的靈魂  |
| **酸** | 木   | 肝    | 悔恨、憤怒   | 聚焦與收斂 (Focus)         | 衝動決策導致後悔 |
| **苦** | 火   | 心    | 執著、幻想   | 清醒與瀉火 (Clarification) | 無法接受現實   |
| **辛** | 金   | 肺    | 悲傷、麻木   | 宣洩與流動 (Catharsis)     | 情感淤塞、憂鬱  |
| **鹹** | 水   | 腎    | 軟弱、失憶   | 意志與記憶 (Willpower)     | 失智、忘記姓名  |

**診斷邏輯**: 靈魂的「點餐需求」往往是表層防衛,玩家需透過觀察與對話,找出深層缺失。

範例:
- **表層**: 過勞死上班族點「高級和牛」(甜/土,追求成就)
- **深層**: 實際缺乏「梅子茶泡飯」(酸/木收斂焦慮 + 鹹/水喚醒根源記憶)

參考: [[../../02-研究分析/靈魂食堂企劃重構#第三部分：五味診斷與標籤考古系統|企劃重構 P.113-158]]

---

### 二、標籤考古玩法 (Tag Foraging)

#### 採集機制
1. **對話高亮**: 靈魂台詞中的關鍵字以特殊顏色標示
2. **點擊採集**: 玩家點擊關鍵字,系統收錄至 `collectedTags`
3. **雜訊過濾**: 部分高亮是「防衛性謊言」,採集會導致料理失敗

範例對話:
```
靈魂: "那年冬天的【雪】下得很大,但我心裡卻有一團【火】。"
可採集標籤: ["cold", "anger/heat"]
```

#### 合成機制 (Alchemy)
進入廚房後,玩家將標籤放入三個插槽:
1. **基底 (Base)**: 料理型態 (米飯/麵條/湯)
2. **調味 (Flavor)**: 五味屬性 (對應診斷結果)
3. **火候 (Heat)**: 時間處理 (慢燉/快炒/冰鎮)

合成範例:
```
Tag: Childhood (Sweet/Base) 
  + Tag: Regret (Sour/Flavor) 
  + Tag: Long Wait (Simmer/Heat)
→ 【回憶苦甜燉肉】(Bittersweet Stew)
```

參考: [[../../01-開發實驗/專案實作對照表#三、recipeDatabase Sheet|實作對照表 - 料理合成規則]]

---

### 三、三日儀式流程

#### Day 1: 誘捕 (The Lure)
**目標**: 破冰,建立信任  
**玩法**: 
- 靈魂進場,狀態混亂/防衛/失憶
- 玩家選擇基礎食物 (熱茶/湯/麵包)
- 觀察靈魂反應,採集「感官標籤」(溫暖/柔軟/鹹味等)

**階段結束條件**: 收集 3+ 個感官標籤

---

#### Day 2: 偵訊 (The Feast)
**目標**: 解鎖核心記憶  
**玩法**:
- 系統根據 Day 1 標籤組合,解鎖「記憶劇場」(Flex Carousel)
- 靈魂開始回憶生前片段
- 玩家繼續採集「情感標籤」(悔恨/執念/愛/遺憾)
- 解鎖「目標料理」

**階段結束條件**: 
- 標籤組合觸發記憶 (例: `["warmth", "softness"]` → 奶奶的羊肉湯)
- `unlockedRecipe` 欄位寫入料理 ID

---

#### Day 3: 赦免 (The Absolution)
**目標**: 完成料理,送別靈魂  
**玩法**:
- 進入廚房,使用收集的標籤合成料理
- 烹飪成功 → 靈魂記憶完整重現,安詳離去
- 烹飪失敗 → 靈魂困惑,需重試或接受「普通結局」

**結局分支**:
- **完美結局**: 標籤 ≥ 5 個 + 料理成功 → 獲得特殊遺物
- **普通結局**: 標籤 3-4 個 + 料理成功 → 靈魂離去,無特殊獎勵
- **失敗結局**: 料理失敗 → 靈魂繼續困於食堂 (可重試 Day 3)

**超渡演出**:
- 靈魂化為光點飄向窗外
- 吧台留下「遺物」(Heirloom)
- 系統記錄至 `completedGuests` 與 `heirlooms`

參考: [[../../02-研究分析/靈魂食堂企劃重構#第四部分：三日敘事範例|企劃重構 P.163-212 - 失憶老裁縫案例]]

---

## 🔧 技術架構 (GAS + LINE OA)

### 核心資料結構: userState (10 欄位)

| 欄位  | 變數名                 | 資料型態        | 企劃概念         | 範例值                              |
| --- | ------------------- | ----------- | ------------ | -------------------------------- |
| A   | `userId`            | String      | LINE User ID | `U1234567890abcdef`              |
| B   | `currentDay`        | Integer     | 當前考古天數 (1-3) | `2`                              |
| C   | `guestID`           | String      | 當前靈魂編號       | `guest1`                         |
| D   | `collectedTags`     | JSON Array  | 收集的標籤        | `["warmth","softness"]`          |
| E   | `lastActive`        | Timestamp   | 最後互動時間       | `2026-01-17 23:45:00`            |
| F   | `unlockedRecipe`    | String      | 解鎖的料理 ID     | `lamb_soup_grandma`              |
| G   | `phase`             | Enum        | 當前階段         | `sensory` / `memory` / `cooking` |
| H   | `inventory`         | JSON Object | 食材庫存         | `{"lamb":1,"carrot":2}`          |
| I   | `completedGuests`   | JSON Array  | 已超渡靈魂        | `["guest1","guest2"]`            |
| J   | `lifetimeHeirlooms` | Integer     | 累計遺物數        | `5`                              |

### 跨日鎖定機制 (宿命感設計)

```javascript
function canProgressToNextDay(userId) {
  const userState = getUserState(userId);
  const lastActive = new Date(userState.lastActive);
  const now = new Date();
  const daysDiff = Math.floor((now - lastActive) / (1000 * 60 * 60 * 24));
  
  if (IS_DEBUG_MODE) return { canProgress: true };
  
  if (daysDiff < 1 && userState.currentDay > 1) {
    return {
      canProgress: false,
      reason: "今天的故事已經結束了。靈魂需要時間沉澱...明天再來吧。☁️"
    };
  }
  
  return { canProgress: true };
}
```

### 標籤驅動對話引擎

```javascript
function findMatchingDialogue(guestID, day, userTags) {
  const library = getDialogueLibrary();
  const prefix = `${guestID}_day${day}_`;
  
  // 遍歷所有對話,找出符合標籤條件的最佳匹配
  for (let key in library) {
    if (!key.startsWith(prefix)) continue;
    
    const entry = library[key];
    const requiredTags = JSON.parse(entry.required_tags || "[]");
    
    const hasAllTags = requiredTags.every(tag => userTags.includes(tag));
    if (hasAllTags) return entry;
  }
  
  return library[`${guestID}_day${day}_default`];
}
```

詳細映射: [[專案實作對照表|專案實作對照表]]

---

## 🎨 靈魂設計: Guest 1 - 失憶老裁縫（田中太郎）

### 角色檔案

- **真實姓名**: 田中太郎（Day 2 揭露）
- **生前職業**: 銀座一流西裝裁縫
- **死因**: 阿茲海默症引發的雪地失溫
- **核心創傷**: 完成女兒婚紗後失憶走失，誤以為一事無成
- **三層創傷結構**:
  - 表層：在雪山中凍死（寒冷、迷茫）
  - 中層：忘記重要的事（焦慮、懊悔）
  - 深層：未能完成對女兒的愛（自責、渴望救贖）
- **生命軌跡**: 30-60歲榮耀職人 → 60-70歲產業衰退決定贖罪 → 70-78歲失智中仍堅持完成

### 重構版劇本架構（V3.0）

#### 核心機制: 記憶即食材系統
```
對話關鍵詞 → 自動解鎖食材 → 用於料理 → 喚醒記憶

範例:
田中: "她笑起來...像蜜糖..."
系統: [記憶碎片：蜜糖般的笑容] 已收集
      → 廚房解鎖：🍯 蜂蜜（抽象食材）
```

#### 儀式化循環: 四時段結構
```
🌙 Night Shift (觀察期)
→ 客人進門，點擊互動點獲取線索

🌅 Day Shift (對話期)  
→ 話題選單（類紅弦俱樂部），套取情報

🍳 Cooking Time (料理期)
→ 用收集的記憶食材做料理

🌃 After Hours (揭露期)
→ 記憶劇場觸發，黑貓評論
```

#### 設計原則
- **去說教化**: 黑貓不解釋，玩家自己體會
- **去中二化**: 拿掉「罪惡吞食者」等詞，用主廚/食堂/客人
- **延遲揭露**: Day 1 玩家也困惑，Day 3 才揭曉真相
- **台詞生動化**: 正常對話完整流暢，記憶閃現保持碎片

#### 黑貓角色: 懶洋洋的老油條店長貓
```
定位: 聒噪但有用的引路者
台詞風格: 
- 「嘖。」「廢話，剛來的都這樣。」
- 「煮飯給他吃啊。不然你以為食堂是幹嘛的？擺好看的嗎？」
動作: 打哈欠、舔爪子、甩尾巴、伸懶腰
```

#### Day 1-3 完整流程

**Day 1: 迷途者與食堂**
- Night: 田中進門，觀察指尖針孔痕跡
- Day: 話題選擇「你的手」，解鎖「針」「縫線」標籤
- Cooking: 用「寒冷+熱水+茶葉」做熱茶
- After Hours: 記憶碎片「小小的手捧著茶杯」

**Day 2: 碎片拼圖**
- Day: 話題選擇「那個夢」，解鎖「女兒-美雪」「蜜糖笑容」
- Cooking: 「蜜糖笑容+遺憾眼淚+蜂蜜+鹹魚」做燉菜
- After Hours: 記憶劇場全面開啟，想起女兒婚禮

**Day 3: 真相與告別**
- Cooking: 所有食材合成「蜜汁炙燒鹹魚」
- 揭露: 田中想起「最後一針縫好了」，安詳離去
- 遺物: 銀頂針（*For my dearest Miyuki*）

### 完整劇本文件

**當前版本**: 
- 檔案: `../../02-劇本設計/Guest1_田中太郎_重構版_神秘感優先.md`
- 行數: 1712 行（完整可直接實裝）
- 狀態: ✅ 劇本完成，台詞已優化
- 更新日期: 2026-01-19

**實作狀態**:
- [x] 完整故事線設計
- [x] 記憶即食材系統設計
- [x] 儀式化循環設計
- [x] 台詞生動化調整
- [ ] 轉換為代碼實作（Week 4 進行中）

---

## 🚨 與舊版本的決裂宣言

### 為何必須放棄「雲寶」?

| 問題 | V1.4 的困境 | V4.0 的解決 |
|------|-----------|-----------|
| **產品裂縫** | 電子寵物+日記的雙重期待無法調和 | 明確定位為「敘事遊戲」 |
| **技術債務** | 3 欄數據無法支撐複雜機制 | 10 欄數據 + 輔助 Sheets |
| **重玩性低** | 單一角色、劇情重複 | 多位靈魂、不同結局 |
| **缺乏目標** | 養成無終點,玩家易流失 | 3 日完整弧線,清晰目標 |

參考: [[架構診斷報告_2026-01-15#Q2：理解「電子寵物包裝的日記」為何產生產品裂縫？|診斷報告 - 裂縫分析]]

---

## 📋 開發里程碑

### ✅ Week 3 (2026-01-15~19): 架構穩定化與劇本深化
- [x] 深度診斷與架構分析
- [x] 建立開發決策鏈文件
- [x] 建立專案實作對照表
- [x] 重構程式碼（6 欄數據結構）
- [x] 實作跨日檢查邏輯
- [x] 畫鬼腳 MVP 部署完成
- [x] **撰寫 Guest 1 完整劇本（重構版）**
- [x] **設計記憶即食材系統**
- [x] **設計儀式化循環結構**
- [x] **完成台詞生動化調整**

### 🔄 Week 4 (2026-01-20~26): 實裝與測試
- [ ] **將田中太郎重構版實裝到代碼**（P0 優先）
  - [ ] 記憶即食材系統實作
  - [ ] 話題選單系統實作
  - [ ] 時段系統實作
- [ ] 設計 Flex Message 模板（記憶劇場、遺物卡）
- [ ] 真實環境測試與調整

### Week 5+: 擴充與優化
- [ ] 根據測試結果優化機制
- [ ] 建立 Guest 2-3 劇本（使用田中太郎模板）
- [ ] 實作 LIFF 烹飪小遊戲原型（可選）
- [ ] 進行封閉測試（5-10 名玩家）

詳細任務: [[../../00-工作區/主 Backlog_2026-01-15|主 Backlog]]

---

## 🎯 成功指標

### 定性指標 (情感深度)
- 測試者是否在告別時感到「不捨但釋然」?
- 是否有測試者主動分享遺物卡片?
- 是否有「我想再見一次那位靈魂」的反饋?

### 定量指標 (留存與完成度)
- **Day 1 → Day 2 留存率**: 目標 > 70%
- **Day 2 → Day 3 留存率**: 目標 > 60%
- **完整通關率**: 目標 > 50%
- **平均標籤採集數**: 目標 ≥ 4 個
- **料理成功率**: 目標 > 80%

---

## 📚 相關資源

### 企劃與研究
- [[../../02-研究分析/靈魂食堂企劃重構|完整企劃重構文件]]
- [[../../02-研究分析/企劃書與Bird Alone結合探討|Bird Alone 情感機制分析]]
- [[../../04-資源素材/技術成本_非即時制設計的優勢|非即時制設計哲學]]

### 技術實作
- [[專案實作對照表|敘事-代碼映射表]]
- [[程式碼.gs|當前代碼 (V1.4)]] - ⚠️ 需重構

### 決策追溯
- [[開發決策鏈|決策考古學]]
- [[架構診斷報告_2026-01-15|架構診斷報告]]

---

## 🔥 立即行動

**如果你是首次接觸本專案**, 請按此順序閱讀:
1. 本文件 (Overview)
2. [[../../02-研究分析/靈魂食堂企劃重構|企劃重構]] (世界觀與機制)
3. [[專案實作對照表|實作對照表]] (如何開發)

**如果你要繼續開發**, 請查看:
- [[主 Backlog_2026-01-15|主 Backlog]] (當前任務)
- [[架構診斷報告_2026-01-15|診斷報告]] (解決方案)

---

**專案信念**:

> 「在數據流中重構人性。」  
> 「見證,而非審判。」  
> 「溫暖,但具有重量。」

---

## 📝 最新進展（2026-01-19）

### Week 3 重大里程碑

**完成事項**:
1. ✅ 畫鬼腳 MVP 部署成功（1/18）
2. ✅ 田中太郎劇本深化完成（1/19）
   - 兩個完整版本（MVP擴充版、重構版）
   - 記憶即食材系統設計
   - 儀式化循環結構
   - 台詞生動化全面調整（1712行）
3. ✅ 所有核心設計決策完成
   - 黑貓角色定位：老油條店長貓
   - 開場方案：方案A神秘版
   - 台詞風格：完整句子+描述+碎片記憶

**下一步**: Week 4 實裝田中太郎重構版

### 關鍵文件更新

| 文件 | 最新版本 | 更新內容 |
|------|---------|---------|
| 田中太郎劇本 | V3.0 重構版 | 1712行完整劇本 + 台詞優化 |
| 工作報告 | 2026-01-19 | 晚間工作總結（決策+調整） |
| 主 Backlog | 2026-01-19 | Week 3 完成，Week 4 規劃 |
| 本企劃書 | V4.1 | 反映最新進展與實作狀態 |

---

**文件狀態**: 🟢 Active  
**最後更新**: 2026-01-19  
**維護者**: 專案負責人  
**下次回顧**: 2026-01-26（Week 4 結束後）
