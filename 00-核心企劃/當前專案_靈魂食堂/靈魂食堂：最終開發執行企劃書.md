

> **專案代號**: CONFITEOR  
> **版本**: Ink 轉型期  
> **最後更新**: 2026-02-17  
> **狀態**: 劇情以 Ink 為 SSOT；世界觀、五味、儀式、角色不變；實作載體見 [[專案實作對照表]] 與 [[開發決策鏈]] 決策點 9

---

## 📋 文件導航

本文件是**靈魂食堂專案的唯一真理來源 (Single Source of Truth)**。  
所有開發、設計、測試決策均應參考此文件。

### 快速導航

**🎯 核心機制**：
- [[#⚙️ 核心機制：五味考古系統|五味考古系統]] - 五味映射、數值系統、延伸話題
- [[#六、儀式流程（誘捕・偵訊・赦免）|儀式流程]] - 誘捕・偵訊・赦免完整流程

**🎨 設計與實作**：
- [[#🎨 靈魂設計: Guest 1 - 失憶老裁縫（田中太郎）|靈魂設計]] - Guest 1 完整設計
- [[#Ink 劇本結構說明（2026-02-17）|Ink 劇本結構說明]] - 節點／章節對應儀式階段、變數與標籤約定
- [[#🔧 技術架構與載體|技術架構與載體]] - 現以 Ink 為劇情 SSOT；原 GAS/LINE 見歸檔
- [[#🎨 UX 設計原則（新增 2026-01-20）|UX 設計原則]] - 載體原生體驗（LINE 版見歸檔）

**📊 進度與決策**：
- [[#📋 開發里程碑|開發里程碑]] - 已完成與進行中
- [[#📝 最新進展|最新進展]] - V4.15 更新內容

### 核心文件連結

1. [[靈魂食堂企劃重構|完整世界觀與機制]] - 來自研究分析的完整企劃
2. [[專案實作對照表|企劃與 Ink 結構映射]] - Ink 版對照表
3. [[產品路線圖]] - Ink 翻譯 → 寫完劇情 → 選殼
4. [[主 Backlog_2026-01-15|當前任務清單]] - Ink 與選殼任務
5. [[開發決策鏈|決策考古學]] - 為何從雲寶演變至此、決策點 9 轉型 Ink

---

## 🎯 專案核心定位

### 從「雲寶」到「靈魂食堂」的進化

| 維度       | 雲寶 (V1.0-V1.4) | 靈魂食堂 (V4.0)        |
| -------- | -------------- | ------------------ |
| **角色**   | 電子寵物           | 罪名吞噬者 (Sin-Eater)  |
| **玩家目標** | 養成陪伴           | 救贖超渡               |
| **核心玩法** | 餵食 + 聊天        | 五味診斷 + 標籤考古 + 料理治癒 |
| **時間結構** | 7 日循環          | 儀式段落、單輪完結       |
| **情感主題** | 孤獨陪伴           | 見證告別               |
| **重玩性**  | 低 (單一角色)       | 高 (多位靈魂、不同結局)      |

---

## 🌍 世界觀：CONFITEOR 邊境食堂

### 核心設定

**地點**: 生與死交界的虛空邊境  
**建築**: 西多會修道院風格的食堂,永恆雨幕籠罩  
**玩家身份**: 罪名吞噬者 (CONFITEOR,拉丁語「我告解」)  
**職責**: 通過料理喚醒靈魂記憶,助其解開執念並前往來世

### 核心哲學：食物作為自白劑（2026-01-24 整合）

> **「每個人都有說不出口的話。食物是最後的翻譯。」**  
> **「進食是靈魂防禦最薄弱的時刻。料理是撬開心防的武器。」**

**設計靈感**：來自「偵訊室豬排飯」的典故——食物不僅是果腹之物，更是卸下心防的工具。

**機制體現**：
- **表層防禦**：靈魂初來時沉默、失憶、迷茫（如田中的「我不記得了」）
- **食物介入**：當靈魂進食時，生理上的脆弱打開了心理的缺口
- **記憶自白**：熱茶觸發「小時候的茶」→ 想起「美雪的小手」→ 說出「對不起」

**與「食罪者」的連結**：
- 玩家不是「審判者」，而是「見證者」與「食罪者」
- 「罪」不是懲罰，而是「未完成的愛」（如田中對美雪的遺憾）
- 透過料理「吃下」靈魂的遺憾，讓他們得以告解並超渡

參考：[[../../02-研究分析/靈魂告解食堂 遊戲概念延伸#3.3 偵訊機制：告解的饗宴|早期設計 P.109-125]]

### 視覺風格

- **外觀**: 哥德式深色調 (黑、深褐、鐵灰)
- **食物**: 吉卜力風格高飽和度、高光澤
- **對比**: 窗外虛空寒冷 vs. 室內爐火溫暖
- **核心元素**: 
  - 格柵 (告解室結構,隔開廚房與用餐區)
  - 藍色爐火 (煉獄之火,提煉情感)
  - 彩色玻璃窗 (繪製食材圖騰而非聖人)

#### Hero 圖系統（2026-02-01 建立，2026-02-03 更新）✅

採用 **Hollow Knight / Alto's Odyssey** 風格的場景插圖，用於 Flex Card 開場與記憶劇場：

| 特徵 | 說明 |
|------|------|
| 風格 | 平面數位插畫、幾何簡化、高對比 |
| 色彩 | 低飽和環境 + 暖光點綴（`#1a1a2e` / `#e09f3e`） |
| 構圖 | 簡單有力、視覺焦點明確、適合小尺寸顯示 |

**已完成 14 張 Hero 圖**：
- Day 1-2：開場、進場、記憶碎片 ×3、料理劇場 ×6（共 11 張）
- Day 3 告別場景：苦味/甜味/平衡結局（共 3 張）

| 結局 | 檔名 | 視覺意象 |
|------|------|----------|
| 苦味 | `day3_farewell_bitter.png` | 老人背對婚紗離去，走向黑暗 |
| 甜味 | `day3_farewell_sweet.png` | 擁抱消融婚紗，仰望幻象太陽（家庭剪影） |
| 平衡 | `day3_farewell_balanced.png` | 女兒引領父親升天，教堂頂窗光 |

詳見 [[../../04-資源素材/靈魂食堂_美術風格分析報告#九、Hero 圖生成規範|美術風格分析報告]]

參考: [[../../02-研究分析/靈魂食堂企劃重構#第二部分：邊境食堂世界觀|企劃重構 P.55-112]]

---

## ⚙️ 核心機制：五味考古系統

### 一、五味映射表 (中醫五行 × 神經美食學)

| 風味    | 五行  | 對應臟器 | 治療的負面情緒 | 敘事功能                  | 適用情境     |
| ----- | --- | ---- | ------- | --------------------- | -------- |
| **甜** | 土   | 脾/胃  | 焦慮、匱乏感  | 撫慰與接地 (Grounding)     | 驚魂未定的靈魂  |
| **酸** | 木   | 肝    | 悔恨、憤怒   | 聚焦與收斂 (Focus)         | 衝動決策導致後悔 |
| **苦** | 火   | 心    | 執著、幻想   | 清醒與瀉火 (Clarification) | 無法接受現實   |
| **辛** | 金   | 肺    | 悲傷、麻木   | 宣洩與流動 (Catharsis)     | 情感淤塞、憂鬱  |
| **鹹** | 水   | 腎    | 軟弱、失憶   | 意志與記憶 (Willpower)     | 失智、忘記姓名  |

**診斷邏輯**: 靈魂的「點餐需求」往往是表層防衛,玩家需透過觀察與對話,找出深層缺失。

範例:
- **表層**: 過勞死上班族點「高級和牛」(甜/土,追求成就)
- **深層**: 實際缺乏「梅子茶泡飯」(酸/木收斂焦慮 + 鹹/水喚醒根源記憶)

參考: [[../../02-研究分析/靈魂食堂企劃重構#第三部分：五味診斷與標籤考古系統|企劃重構 P.113-158]]

---

### 二、五味數值系統與食材解鎖敘事（V4.4 完整實作版）

#### 核心設計哲學：側寫角度，而非結局分歧

> **「不是結局的分歧，而是側寫的角度不同。」**

傳統多結局設計會讓玩家產生「沒玩到真結局」的挫敗感。我們採用**「食材解鎖敘事（Ingredient-Driven Narrative）」**：

- ❌ 不同選擇 → 不同結局（玩家焦慮「選錯了」）
- ✅ 不同食材 → 不同角度理解角色（每次都是完整體驗）

這更符合「見證者」定位——你不是在「選結局」，而是在「選擇如何理解這個人」。

---

#### 五味數值系統實作（V4.4 完成）✅

**核心機制**：
- ✅ 建立 `MEMORY_FLAVOR_MAP` 對照表（記憶標籤 → 五味數值）
- ✅ 實作 `calculateFlavorBalance()` 函數（累加所有收集記憶的五味數值）
- ✅ 實作 `determineEnding()` 函數（依據五味比例判定結局類型）
- ✅ 調整「裁縫手藝」味覺數值（甜 1→3、鹹 3→2），優化甜味路線達成條件

**五味映射邏輯**：
- **甜**（土）：撫慰與接地 → 適用驚魂未定的靈魂
- **酸**（木）：聚焦與收斂 → 適用衝動決策導致後悔
- **苦**（火）：清醒與瀉火 → 適用無法接受現實
- **辛**（金）：宣洩與流動 → 適用情感淤塞、憂鬱
- **鹹**（水）：意志與記憶 → 適用失智、忘記姓名

**數值定義**（每個標籤 0-6 分，高價值記憶可達 6 分）:

| 風味  | 代表情緒    | 累積過多的效果   | 累積不足的效果 |
| --- | ------- | --------- | ------- |
| 甜   | 溫暖、愛、滿足 | 過度美化，逃避現實 | 缺乏慰藉，空虛 |
| 酸   | 悔恨、反省   | 陷入自責漩渦    | 無法面對錯誤  |
| 苦   | 清醒、接受   | 過度悲觀      | 活在幻想中   |
| 辛   | 宣洩、流動   | 情緒失控      | 情感麻木    |
| 鹹   | 記憶、根源   | 困在過去      | 忘記自我    |

**計算邏輯**:
```javascript
// Day 3 結局前，計算五味總和
function calculateFlavorBalance(collectedMemories) {
  let flavors = { sweet: 0, sour: 0, bitter: 0, spicy: 0, salty: 0 };
  
  collectedMemories.forEach(memory => {
    const values = MEMORY_FLAVOR_MAP[memory];
    if (values) {
      flavors.sweet += values.sweet || 0;
      flavors.sour += values.sour || 0;
      flavors.bitter += values.bitter || 0;
      flavors.spicy += values.spicy || 0;
      flavors.salty += values.salty || 0;
    }
  });
  
  return flavors;
}
```

---

#### 田中太郎記憶標籤五味對照表（完整版）

> 每個標籤分數 0-3，總分會影響結局語氣

##### Day 1 可收集（基礎層）

| 話題    | 記憶標籤    | 甜   | 酸   | 苦   | 辛   | 鹹   | 敘事功能  |
| ----- | ------- | --- | --- | --- | --- | --- | ----- |
| 你的手   | 🪡 針    | 0   | 1   | 2   | 0   | 1   | 執念的象徵 |
| 你的手   | 🧵 縫線   | 1   | 0   | 1   | 0   | 2   | 連結的隱喻 |
| 你的手   | ❄️ 寒冷   | 0   | 2   | 2   | 1   | 0   | 死亡的觸感 |
| 你的手   | 🧤 裁縫手藝 | 1   | 0   | 1   | 0   | 3   | 一生的驕傲 |
| 你從哪裡來 | 🌫️ 失憶  | 0   | 2   | 2   | 0   | 0   | 喪失自我  |
| 你從哪裡來 | 😶 迷茫   | 0   | 1   | 2   | 1   | 0   | 困惑無助  |
| 窗外的雨  | 🌧️ 雨聲  | 0   | 0   | 1   | 1   | 1   | 氛圍鋪陳  |
| 窗外的雨  | 💧 潮濕   | 0   | 1   | 1   | 1   | 0   | 陰鬱壓抑  |
| 沉默陪伴  | 🤫 寧靜   | 1   | 0   | 1   | 0   | 1   | 平和接受  |
| 沉默陪伴  | 🤝 陪伴   | 2   | 0   | 0   | 0   | 1   | 溫暖信任  |

##### Day 2 可收集（深入層）

| 話題 | 記憶標籤 | 甜 | 酸 | 苦 | 辛 | 鹹 | 敘事功能 |
|------|----------|----|----|----|----|----|---------| 
| 那個夢 | 🍯 蜜糖笑容 | 3 | 0 | 0 | 0 | 1 | 女兒的愛（核心甜） |
| 那個夢 | 👧 女兒-美雪 | 2 | 1 | 0 | 1 | 2 | 核心牽掛（平衡） |
| 那個夢 | 💍 婚紗 | 2 | 2 | 1 | 0 | 1 | 未竟之願（苦甜交織） |
| 那個夢 | 😢 眼淚 | 0 | 1 | 1 | 3 | 0 | 情感宣洩（高辛） |
| 你在找什麼 | 🎯 執念 | 0 | 1 | 3 | 0 | 1 | 無法放下（高苦） |
| 你怎麼來的 | ❄️ 雪 | 0 | 1 | 2 | 1 | 1 | 死亡場景 |
| 你怎麼來的 | 💀 死亡 | 0 | 2 | 3 | 0 | 0 | 終結之痛（高苦+酸） |

##### 延伸話題新增記憶（V4.5 更新）⭐

| 延伸話題        | 記憶標籤         | 甜   | 酸   | 苦   | 辛   | 鹹   | 敘事功能        |
| ----------- | ------------ | --- | --- | --- | --- | --- | ----------- |
| 你的手延伸       | 🏆 銀座的驕傲     | 6   | 0   | 0   | 0   | 0   | 職業巔峰（高甜值）   |
| 那個夢延伸       | 😊 美雪的笑容     | 6   | 0   | 0   | 0   | 0   | 父女純甜記憶（高甜值） |
| 那個夢延伸       | 👨‍👧 第一次叫爸爸 | 5   | 0   | 0   | 0   | 0   | 父女關係核心（高甜值） |
| 你怎麼來的延伸     | 🪡 最後一針      | 0   | 0   | 高   | 0   | 0   | 死亡前執念（高苦值）  |
| 你怎麼來的延伸     | 🏠 閣樓        | 0   | 0   | 高   | 0   | 0   | 未完成遺憾（高苦值）  |
| **V4.5 新增** | 📉 空蕩的店      | 0   | 2   | 1   | 0   | 3   | 時代孤獨（高鹹值）   |
| **V4.5 新增** | 👔 缺席的典禮     | 0   | 1   | 3   | 3   | 0   | 裂痕事件（高苦辛值）  |
| **V4.5 新增** | 🗣️ 失語       | 0   | 3   | 1   | 0   | 2   | 翻譯者概念（高酸鹹值） |

##### 五味總分設計邏輯

| 收集路線 | 預期五味傾向 | 可能結局 |
|----------|--------------|----------|
| 只做 Day 1 + 少量 Day 2 | 苦鹹偏高 | 普通結局（帶遺憾離去） |
| Day 1 全收 + Day 2「那個夢」完整 | 甜鹹平衡 | 真結局（釋懷離去） |
| 只收「蜜糖笑容」不收「執念」「死亡」 | 甜味過重 | 特殊結局（沉浸美好） |
| 大量收集「執念」「死亡」「寒冷」 | 苦酸爆表 | 普通結局（悲傷離去） |

---

#### 結局語氣分歧（基於五味平衡）

##### 判定邏輯（實作參考）

```javascript
// 五味數值對照表
const MEMORY_FLAVOR_MAP = {
  // Day 1
  "針":       { sweet: 0, sour: 1, bitter: 2, spicy: 0, salty: 1 },
  "縫線":     { sweet: 1, sour: 0, bitter: 1, spicy: 0, salty: 2 },
  "寒冷":     { sweet: 0, sour: 2, bitter: 2, spicy: 1, salty: 0 },
  "裁縫手藝": { sweet: 3, sour: 0, bitter: 1, spicy: 0, salty: 2 }, // V4.4 調整：甜 1→3、鹹 3→2
  "失憶":     { sweet: 0, sour: 2, bitter: 2, spicy: 0, salty: 0 },
  "迷茫":     { sweet: 0, sour: 1, bitter: 2, spicy: 1, salty: 0 },
  "雨聲":     { sweet: 0, sour: 0, bitter: 1, spicy: 1, salty: 1 },
  "潮濕":     { sweet: 0, sour: 1, bitter: 1, spicy: 1, salty: 0 },
  "寧靜":     { sweet: 1, sour: 0, bitter: 1, spicy: 0, salty: 1 },
  "陪伴":     { sweet: 2, sour: 0, bitter: 0, spicy: 0, salty: 1 },
  // Day 2
  "蜜糖笑容": { sweet: 3, sour: 0, bitter: 0, spicy: 0, salty: 1 },
  "女兒-美雪": { sweet: 2, sour: 1, bitter: 0, spicy: 1, salty: 2 },
  "婚紗":     { sweet: 2, sour: 2, bitter: 1, spicy: 0, salty: 1 },
  "眼淚":     { sweet: 0, sour: 1, bitter: 1, spicy: 3, salty: 0 },
  "執念":     { sweet: 0, sour: 1, bitter: 3, spicy: 0, salty: 1 },
  "雪":       { sweet: 0, sour: 1, bitter: 2, spicy: 1, salty: 1 },
  "死亡":     { sweet: 0, sour: 2, bitter: 3, spicy: 0, salty: 0 }
};

// 結局判定
function determineEnding(flavors) {
  const { sweet, sour, bitter, spicy, salty } = flavors;
  const total = sweet + sour + bitter + spicy + salty;
  
  // 情境 C：甜味過重（沉浸美好）
  if (sweet > (sour + bitter + spicy + salty)) {
    return "ENDING_SWEET"; // 特殊結局
  }
  
  // 情境 A：苦味過重（帶遺憾）
  if (bitter > (sweet + salty)) {
    return "ENDING_BITTER"; // 普通結局
  }
  
  // 情境 B：回甘平衡（釋懷）
  if ((sweet + salty) >= (bitter + sour)) {
    return "ENDING_BALANCED"; // 真結局
  }
  
  // 預設：普通結局
  return "ENDING_BITTER";
}
```

##### 結局演出文本

**情境 A：苦味過重 → 職人的徒勞（普通結局）**（V4.9 修正）
> 【老人看著自己的手，露出淒涼的苦笑】
> 「那件婚紗...真的很美。是我這輩子最好的作品。」
> 「但是...那又怎樣呢？」
> 
> 【他的眼神清醒，淚流滿面】
> 「它現在躺在漆黑的櫃子裡。而我...倒在雪地裡。」
> 「沒人知道我做好了。也沒人會來穿它了。」
> 
> 【設計理念】：真正的苦，不是「做不到」，而是「做到了，卻沒有意義」。
> 
> *遺物：一根彎曲的縫紉針*

**情境 B：回甘平衡 → 釋懷離去（真結局）**
> 【老人突然睜大眼睛】
> 「我想起來了...」
> 「最後一針...我縫好了。」
> 
> 【他微笑著】
> 「美雪...婚紗在閣樓。爸爸做好了。」
> 「穿上去一定很美。」
> 
> *遺物：銀頂針（刻字：For my dearest Miyuki）*

**情境 C：甜味過重 → 沉浸美好（特殊結局）**
> 【老人的眼神變得柔和】
> 「美雪小時候笑起來好可愛...」
> 「她喜歡穿我做的洋裝，在院子裡轉圈圈...」
> 
> 【他閉上眼睛，嘴角上揚】
> 「...等等，我好像忘了什麼...」
> 「算了...現在這樣就很好...」
> 
> *遺物：一張泛黃的照片（父女合照）*

#### 人物紀傳解鎖系統

結局達成後，玩家可在「人物紀傳」中解鎖對應的生平故事：

| 結局類型 | 解鎖章節 | 內容主題 | 文件 |
|----------|----------|----------|------|
| 🍯 **甜味結局** | 前篇：針尖工房與雪子 | 銀座的驕傲、雪子的愛、美好的回憶 | `田中太郎_人生紀實_前篇.md` |
| ☕ **苦味結局** | 中篇：裂痕與遺忘 | 缺席的典禮、父女之間的牆、說不出口的對不起 | `田中太郎_人生紀實_中篇.md` |
| ⚖️ **平衡結局** | 後篇：最後一針 | 決心、遺忘、最後一針、雪夜、釋懷 | `田中太郎_人生紀實_後篇.md` |

**設計理念**：
- 三個結局視角互補，構成完整的田中太郎人生
- 玩家需多周目體驗，才能拼湊完整故事
- 鼓勵探索不同選擇路線

---

### 三、縱向延伸話題系統（V4.5 更新）⭐

#### 設計理念

**核心概念**：深挖角色深度，而非橫向擴展
- 玩家視角：不知道角色背景，只能透過追問逐步挖掘
- 避免上帝視角：不直接告訴玩家「這是田中太郎，他是裁縫師」
- 層層剝開：從表層對話 → 延伸追問 → 深層記憶

#### Day 1 延伸話題

**「你的手」→「那…這雙手做過最驕傲的事是什麼？」**（`hands_pride`）
- 解鎖條件：完成 `hands_part2` 後出現
- 獲得記憶：`銀座的驕傲`（甜 6）
- 劇情意義：從「手的功能」深挖到「手的意義」，揭示田中職業生涯的巔峰
- 五味傾向：強烈甜味（撫慰與接地）

**V4.5 新增：「你的手」→「後來呢？」**（`twilight_artisan`）
- 解鎖條件：完成 `hands_part2` 後出現
- 獲得記憶：`空蕩的店`（鹹 3, 酸 2, 苦 1）
- 劇情意義：從「職業榮耀」深挖到「時代淘汰」，解釋他為何退縮到閣樓
- 五味傾向：高鹹值（時代孤獨感）
- 核心台詞：「這雙手以前被很多人需要。但現在...連穿針都會抖，也沒人願意等了。」

#### Day 2 延伸話題

**「那個夢」→「夢裡那個小女孩…她小時候是什麼樣子？」**（`miyuki_childhood`）
- 解鎖條件：完成 `dream_part3` 後出現
- 獲得記憶：`美雪的笑容`（甜 6）、`第一次叫爸爸`（甜 5）
- 劇情意義：從「夢境」深挖到「美雪的童年」，強化父女關係的情感連結
- 五味傾向：強烈甜味（父女純甜記憶）

**V4.5 新增：「那個夢」→「為什麼她會哭？」**（`ceremony_rift`）
- 解鎖條件：完成 `dream_part3` 後出現
- 獲得記憶：`缺席的典禮`（苦 3, 辛 3, 酸 1）
- 劇情意義：揭示父女決裂的「原爆點」——入學典禮缺席事件
- 五味傾向：高苦辛值（罪惡感與悔恨）
- 核心台詞：「那件西裝很完美。但我永遠失去了我最重要的觀眾。」

**「你怎麼來的」→「你說有很多雪…那時候你原本在做什麼？」**（`snow_then`）
- 解鎖條件：完成 `death` 話題後出現
- 獲得記憶：`最後一針`、`閣樓`（高苦值）
- 劇情意義：從「死亡場景」深挖到「死亡前的最後時刻」，揭示田中的執念
- 五味傾向：高苦值（聚焦死亡前的遺憾與未完成）

#### Day 2 料理增強（V4.5 新增）

**撫慰鹹粥 → 翻譯者概念**
- 觸發條件：做撫慰鹹粥時自動觸發
- 新增記憶：`失語`（酸 3, 鹹 2, 苦 1）
- 劇情意義：揭示妻子雪子是田中的「翻譯介面」，她走後他失去表達愛的能力
- 核心台詞：「別擔心，我會幫你翻譯的。你的針線話，我都聽得懂。」
- 結尾文本：「然而，翻譯的人走了。剩下一個啞巴父親，和一個聽不懂針線話的女兒。」

---

### 四、橫向劇情發展：甜/苦路線設計（V4.5 更新）

#### 甜味過重路線（重新定義）

**路線組成**：`沉默陪伴` + `那個夢` + `關於美雪小時候`（延伸話題）

**調整內容**：
- 避免「你的手」話題（五味混合，不易達成甜味過重）
- 聚焦「沉默陪伴」的寧靜感、「那個夢」的溫暖、「美雪小時候」的純甜記憶
- 配方調整：`熱茶` 配方擴展為接受 `寧靜` + `陪伴` 記憶，讓「沉默陪伴」路線可在 Day 1 完成料理

**設計目標**：讓玩家更容易達成甜味過重結局，體驗「沉浸美好」的特殊結局

#### 苦味過重路線（新設計）

**路線組成**：`你怎麼來的` + `雪中那時…`（延伸話題）

**記憶標籤**：`最後一針`、`閣樓`（高苦值）

**劇情意義**：聚焦死亡前的遺憾與未完成

**設計目標**：讓玩家體驗「帶遺憾離去」的普通結局，感受田中的執念與未完成

#### 結局判定邏輯

**保持 `determineEnding()` 原始邏輯**：
- `sweet > others` 判定甜味結局
- `bitter > (sweet + salty)` 判定苦味結局
- `(sweet + salty) >= (bitter + sour)` 判定平衡結局

**設計理念**：內容引導 > 邏輯限制
- 不改變判定條件，而是透過調整話題內容與記憶數值
- 讓玩家更容易達成特定路線
- 透過內容設計引導玩家自然走向特定結局

---

#### 層次化記憶揭露（目前實作狀態）

設計讓玩家有「逐漸理解」的感覺，而非一次性倒出所有資訊：

##### Day 1 話題（基礎層）- ✅ 已實作

| 話題 | 觸發文字 | 獲得食材 | 五味傾向 |
|------|----------|----------|----------|
| 你的手 | 「你的手...是做什麼工作的？」 | 針、縫線、寒冷、裁縫手藝 | 苦鹹為主 |
| 你從哪裡來 | 「你是從哪裡來的？」 | 失憶、迷茫 | 苦酸為主 |
| 窗外的雨 | 「外面的雨...很大呢」 | 雨聲、潮濕 | 苦辛平衡 |
| 沉默陪伴 | 「...（不說話，靜靜陪伴他）」 | 寧靜、陪伴 | 甜鹹為主 |

##### Day 2 話題（深入層）- ✅ 已實作

| 話題 | 觸發文字 | 獲得食材 | 五味傾向 | 備註 |
|------|----------|----------|----------|------|
| 那個夢 | 「你夢到了什麼？」 | 蜜糖笑容、女兒-美雪、婚紗、眼淚 | 甜辛平衡 | 分 3 段推進 |
| 你在找什麼 | 「你在找什麼？」 | 執念、婚紗 | 苦為主 | - |
| 你怎麼來的 | 「你是怎麼來到這裡的？」 | 雪、死亡、寒冷 | 苦酸為主 | - |

##### 未來規劃：話題前置條件（V5.0）

目前所有話題都是開放的，未來可加入前置條件增加深度：

```
Day 2 隱藏話題（未實作）:
- 【隱藏】那個人 → 需前置：Day 1 選擇「沉默陪伴」
- 【隱藏】最後一天 → 需前置：收集「針」+「縫線」+「婚紗」
```

這讓田中太郎像個「活人」——他會因為你的聆聽態度，決定要吐露多少真相。

---

### 五、食材收集機制（MVP vs 未來版對照）

#### MVP 實作方式（目前 V4.x）

> **設計原則**：簡化互動，聚焦敘事體驗

| 階段 | 機制 | 說明 |
|------|------|------|
| **對話期** | 話題選擇 → 自動獲得食材 | 完成話題後系統自動收集記憶標籤 |
| **料理期** | 預設配方 | 根據收集的食材，系統自動建議料理 |
| **結局** | 五味數值計算 | 根據標籤的五味總和，決定結局語氣 |

**MVP 優點**：
- 開發快速，體驗順暢
- 核心「側寫角度」效果已可實現
- 適合 LINE OA 純對話介面

---

#### 未來擴展：LIFF 標籤考古系統（V5.0+ 規劃）

> ⚠️ **此章節為未來擴展規劃，非目前實作範圍**

如果想要更豐富的「標籤考古」體驗，可透過 LIFF（LINE Front-end Framework）實現：

##### 採集機制（需 LIFF）
1. **對話高亮**: 靈魂台詞中的關鍵字以特殊顏色標示
2. **點擊採集**: 玩家在 LIFF 頁面中點擊關鍵字，拖拉至背包
3. **雜訊過濾**: 部分高亮是「防衛性謊言」，採集會導致料理失敗

範例對話:
```
靈魂: "那年冬天的【雪】下得很大,但我心裡卻有一團【火】。"
可採集標籤: ["cold", "anger/heat"]
```

##### 合成機制（需 LIFF）
進入 LIFF 廚房頁面後，玩家將標籤放入三個插槽:
1. **基底 (Base)**: 料理型態 (米飯/麵條/湯)
2. **調味 (Flavor)**: 五味屬性 (對應診斷結果)
3. **火候 (Heat)**: 時間處理 (慢燉/快炒/冰鎮)

合成範例:
```
Tag: Childhood (Sweet/Base) 
  + Tag: Regret (Sour/Flavor) 
  + Tag: Long Wait (Simmer/Heat)
→ 【回憶苦甜燉肉】(Bittersweet Stew)
```

##### LIFF 頁面功能規劃
```
LIFF 標籤考古系統
├── 📖 對話閱讀頁
│   ├── 高亮關鍵字顯示
│   ├── 點擊採集動畫
│   └── 背包即時更新
├── 🎒 背包管理頁
│   ├── 已收集標籤列表
│   ├── 五味數值雷達圖
│   └── 標籤詳情與故事提示
├── 🍳 廚房合成頁
│   ├── 三插槽拖拉介面
│   ├── 配方預覽
│   └── 烹飪動畫
└── 📊 結局統計頁
    ├── 五味平衡分析
    └── 解鎖成就
```

##### 開發優先級
- **P3**（低優先）：待 MVP 驗證成功後再評估
- **預估工時**：2-3 週（前端 + 後端整合）
- **前置條件**：MVP 留存率 > 60%、用戶反饋希望更多互動

參考: [[../../01-開發實驗/專案實作對照表#三、recipeDatabase Sheet|實作對照表 - 料理合成規則]]

---

### 五-A、料理食譜系統（結構設計庫）⭐ V4.10 新增

> **此章節為未來 Guest 開發的結構模板，確保料理系統設計一致性。**

#### 設計原則：有啥食材顯示啥

參考 Day 3 的動態顯示邏輯，統一 Day 1-3 的料理演出：

```javascript
// 核心邏輯：從玩家實際收集的記憶中，篩選出與該料理相關的記憶來顯示
const memories = state ? (state.collectedMemories || []) : [];
const collected = memories.filter(m => recipeMemories.includes(m));
let memoryList = collected.map(m => `「${m}」`).join("、");
```

**設計哲學**：
- ❌ 寫死記憶名稱 → 玩家看到自己沒收集的記憶，產生困惑
- ✅ 動態顯示實際收集的記憶 → 「真的在用我收集的食材做菜」的沉浸感

---

#### 各階段料理對照表（Guest 1: 田中太郎）

##### Day 1 料理

| 料理 | 解鎖條件 | 相關記憶池 | 實作函數 |
|------|----------|------------|----------|
| ☕ 熱茶 | 寒冷 OR 針 OR 縫線 OR (寧靜+陪伴) | 針、縫線、寒冷、寧靜、陪伴 | `getDay1CookingTea_Part1(state)` |
| 🍜 熱湯 | 雨聲 OR 失憶 OR 迷茫 | 雨聲、失憶、迷茫 | `getDay1CookingSoup_Part1(state)` |

##### Day 2 料理

| 料理 | 解鎖條件 | 相關記憶池 | 實作函數 |
|------|----------|------------|----------|
| 🍜 蜜汁燉菜 | 蜜糖笑容 + 眼淚 | 蜜糖笑容、眼淚 | `getDay2CookingResult(state)` |
| 🥣 苦辛醒神湯 | 執念 + (雪 OR 死亡) | 執念、雪、死亡 | `getDay2CookingResult_苦辛(state)` |
| 🍚 撫慰鹹粥 | 寧靜 + 陪伴 | 寧靜、陪伴 | `getDay2CookingResult_撫慰()` |

##### Day 3 最終料理（系統自動決定）

| 料理 | 觸發條件 | 使用記憶 | 實作函數 |
|------|----------|----------|----------|
| 🍬 糖霜幻景拼盤 | 甜味 > 其他四味總和 | 全部收集的記憶 | `getDay3CookingStart(state)` |
| 🦴 千針冷骨湯 | 苦味 > (甜味+鹹味) | 全部收集的記憶 | `getDay3CookingProcess_Part1(state)` |
| 🐟 百味蜜汁炙燒魚 | 平衡（不符合前兩者） | 全部收集的記憶 | `getDay3CookingProcess_Part2(state)` |

---

#### 解鎖邏輯設計規範

**Day 1-2 料理解鎖**（玩家選擇）：
```javascript
function getDayXAvailableRecipes(memories) {
  const m = (x) => (memories || []).includes(x);
  const out = [];
  // OR 條件：任一記憶解鎖
  if (m("記憶A") || m("記憶B")) out.push("料理1");
  // AND 條件：需要多個記憶
  if (m("記憶C") && m("記憶D")) out.push("料理2");
  // 混合條件
  if (m("記憶E") && (m("記憶F") || m("記憶G"))) out.push("料理3");
  return out;
}
```

**Day 3 最終料理**（系統決定）：
```javascript
function determineEnding(flavors) {
  const { sweet, sour, bitter, spicy, salty } = flavors;
  const others = sour + bitter + spicy + salty;
  
  if (sweet > others) return "ENDING_SWEET";      // 甜味過重
  if (bitter > (sweet + salty)) return "ENDING_BITTER";  // 苦味過重
  return "ENDING_BALANCED";  // 平衡
}
```

---

#### 新增 Guest 時的檢查清單

- [ ] 設計該 Guest 的記憶標籤（每個標籤需有五味數值）
- [ ] 設計 Day 1-2 可選料理（解鎖條件 + 相關記憶池）
- [ ] 設計 Day 3 最終料理（根據五味傾向的三種變體）
- [ ] 實作料理演出函數，接收 `state` 參數並動態顯示記憶
- [ ] 更新 `MEMORY_FLAVOR_MAP` 對照表
- [ ] 更新 `getDayXAvailableRecipes` 解鎖函數

---

### 六、儀式流程（誘捕・偵訊・赦免）

#### Day 1: 誘捕 (The Lure)
**目標**: 破冰,建立信任  
**玩法**: 
- 靈魂進場,狀態混亂/防衛/失憶
- 玩家選擇基礎食物 (熱茶/湯/麵包)
- 觀察靈魂反應,採集「感官標籤」(溫暖/柔軟/鹹味等)

**階段結束條件**: 收集 3+ 個感官標籤

---

#### Day 2: 偵訊 (The Feast)
**目標**: 解鎖核心記憶  
**玩法**:
- 系統根據 Day 1 標籤組合,解鎖「記憶劇場」(Flex Carousel)
- 靈魂開始回憶生前片段
- 玩家繼續採集「情感標籤」(悔恨/執念/愛/遺憾)
- 解鎖「目標料理」

**階段結束條件**: 
- 標籤組合觸發記憶 (例: `["warmth", "softness"]` → 奶奶的羊肉湯)
- `unlockedRecipe` 欄位寫入料理 ID

---

#### Day 3: 赦免 (The Absolution)
**目標**: 完成料理,送別靈魂  
**玩法**:
- 進入廚房,使用收集的標籤合成料理
- 烹飪成功 → 靈魂記憶完整重現,安詳離去
- 烹飪失敗 → 靈魂困惑,需重試或接受「普通結局」

**結局分支**:
- **完美結局**: 標籤 ≥ 5 個 + 料理成功 → 獲得特殊遺物
- **普通結局**: 標籤 3-4 個 + 料理成功 → 靈魂離去,無特殊獎勵
- **失敗結局**: 料理失敗 → 靈魂繼續困於食堂 (可重試 Day 3)

**超渡演出**:
- 靈魂化為光點飄向窗外
- 吧台留下「遺物」(Heirloom)
- 系統記錄至 `completedGuests` 與 `heirlooms`

參考: [[../../02-研究分析/靈魂食堂企劃重構#第四部分：敘事範例|企劃重構 P.163-212 - 失憶老裁縫案例]]

---

## Ink 劇本結構說明（2026-02-17）

**定位**：劇情單一來源（SSOT）為 Ink 劇本；本節為企劃與 Ink 結構之對應摘要，詳見 [[專案實作對照表]]。

### 節點／章節對應儀式階段

| 儀式 | 建議 Knot 命名 | 企劃對應 |
|------|----------------|----------|
| 誘捕 | `Day1_Night`、`Day1_Day` | 開場、觀察、話題選擇、基礎記憶 |
| 偵訊 | `Day2_Day` | 延伸話題、進階記憶 |
| 赦免（料理） | `Day1_Cooking`、`Day2_Cooking`、`Day3_Cooking` | 熱茶/熱湯、進階料理、最終料理 |
| 揭露/結束 | `Day1_After`、`Day2_After`、`Day3_After` | 過渡、告別、結局 |

### 變數與標籤約定

| 企劃概念 | Ink 變數建議 |
|----------|---------------|
| 當前天數 | `current_day` (INT, 1–3) |
| 當前階段 | `phase` (night / day / cooking / after) |
| 已收集記憶 | `collected_memories` (LIST) |
| 已完成話題 | `topics_done` (LIST) |
| 本輪做過的料理 | `dishes_cooked` (LIST) |
| 結局類型 | `ending_type` (SWEET / BITTER / BALANCED) |

翻譯與對照：[[GAS→Ink 翻譯對照表]]。

---

## 🔧 技術架構與載體

**現行實作**：劇情以 **Ink** 為 SSOT，數據結構、階段推進、knot 與變數對應見 [[專案實作對照表]]（Ink 版）。接殼（Twine／網頁／Ren'Py）時內容不改，僅更換播放器。

**歷史參考**：原 GAS + LINE OA 架構見 [[專案實作對照表_LINE-GAS_歸檔]] 與 `01-開發實驗/歷史檔案/archive-line-liff/`。轉型原因見 [[開發決策鏈]] 決策點 9。

---

## 🎨 靈魂設計: Guest 1 - 失憶老裁縫（田中太郎）

### 角色檔案

- **真實姓名**: 田中太郎（Day 2 揭露）
- **生前職業**: 銀座一流西裝裁縫
- **死因**: 阿茲海默症引發的雪地失溫
- **核心創傷**: 完成女兒婚紗後失憶走失，誤以為一事無成
- **三層創傷結構**:
  - 表層：在雪山中凍死（寒冷、迷茫）
  - 中層：忘記重要的事（焦慮、懊悔）
  - 深層：未能完成對女兒的愛（自責、渴望救贖）
- **生命軌跡**: 30-60歲榮耀職人 → 60-70歲產業衰退決定贖罪 → 70-78歲失智中仍堅持完成

### 重構版劇本架構（V3.0）

#### 核心機制: 記憶即食材系統
```
對話關鍵詞 → 自動解鎖食材 → 用於料理 → 喚醒記憶

範例:
田中: "她笑起來...像蜜糖..."
系統: [記憶碎片：蜜糖般的笑容] 已收集
      → 廚房解鎖：🍯 蜂蜜（抽象食材）
```

#### 儀式化循環: 四時段結構
```
🌙 Night Shift (觀察期)
→ 客人進門，點擊互動點獲取線索

🌅 Day Shift (對話期)  
→ 話題選單（類紅弦俱樂部），套取情報

🍳 Cooking Time (料理期)
→ 用收集的記憶食材做料理

🌃 After Hours (揭露期)
→ 記憶劇場觸發，黑貓評論
```

#### 設計原則
- **去說教化**: 黑貓不解釋，玩家自己體會
- **去中二化**: 拿掉「罪惡吞食者」等詞，用主廚/食堂/客人
- **延遲揭露**: Day 1 玩家也困惑，Day 3 才揭曉真相
- **台詞生動化**: 正常對話完整流暢，記憶閃現保持碎片

#### 黑貓角色: 懶洋洋的老油條店長貓
```
定位: 聒噪但有用的引路者
台詞風格: 
- 「嘖。」「廢話，剛來的都這樣。」
- 「煮飯給他吃啊。不然你以為食堂是幹嘛的？擺好看的嗎？」
動作: 打哈欠、舔爪子、甩尾巴、伸懶腰
```

#### Day 1-3 完整流程

**Day 1: 迷途者與食堂**
- Night: 田中進門，觀察指尖針孔痕跡
- Day: 話題選擇「你的手」，解鎖「針」「縫線」標籤
- Cooking: 用「寒冷+熱水+茶葉」做熱茶
- After Hours: 記憶碎片「小小的手捧著茶杯」

**Day 2: 碎片拼圖**
- Day: 話題選擇「那個夢」，解鎖「女兒-美雪」「蜜糖笑容」
- Cooking: 「蜜糖笑容+遺憾眼淚+蜂蜜+鹹魚」做燉菜
- After Hours: 記憶劇場全面開啟，想起女兒婚禮

**Day 3: 真相與告別**
- Cooking: 根據五味傾向動態決定最終料理（V4.9）：
  - 🍬 甜味過重 → 糖霜幻景拼盤
  - 🦴 苦味過重 → 千針冷骨湯
  - 🐟 平衡 → 百味蜜汁炙燒魚
- 揭露: 田中想起真相（根據結局不同）
- 遺物: 根據結局不同（彎曲的針/銀頂針/泛黃照片）

### 完整劇本文件

**當前版本**: 
- 檔案: `../../02-劇本設計/Guest1_田中太郎_重構版_神秘感優先.md`
- 行數: 1712 行（完整可直接實裝）
- 狀態: ✅ 劇本完成，台詞已優化
- 更新日期: 2026-01-19

**實作狀態**:
- [x] 完整故事線設計
- [x] 記憶即食材系統設計
- [x] 儀式化循環設計
- [x] 台詞生動化調整
- [x] ✅ **轉換為代碼實作完成** (2026-01-20)
  - 代碼文件: `01-開發實驗/程式碼/靈魂食堂_田中太郎重構版.gs`
  - 代碼行數: ~1200 行
  - 部署指南: `01-開發實驗/程式碼/田中太郎版部署指南.md`

---

## 🚨 與舊版本的決裂宣言

### 為何必須放棄「雲寶」?

| 問題 | V1.4 的困境 | V4.0 的解決 |
|------|-----------|-----------|
| **產品裂縫** | 電子寵物+日記的雙重期待無法調和 | 明確定位為「敘事遊戲」 |
| **技術債務** | 3 欄數據無法支撐複雜機制 | 10 欄數據 + 輔助 Sheets |
| **重玩性低** | 單一角色、劇情重複 | 多位靈魂、不同結局 |
| **缺乏目標** | 養成無終點,玩家易流失 | 儀式段落單輪完結,清晰目標 |


---

## 📋 開發里程碑

### ✅ Week 3 (2026-01-15~19): 架構穩定化與劇本深化
- [x] 深度診斷與架構分析
- [x] 建立開發決策鏈文件
- [x] 建立專案實作對照表
- [x] 重構程式碼（6 欄數據結構）
- [x] 實作階段推進邏輯
- [x] 畫鬼腳 MVP 部署完成
- [x] **撰寫 Guest 1 完整劇本（重構版）**
- [x] **設計記憶即食材系統**
- [x] **設計儀式化循環結構**
- [x] **完成台詞生動化調整**

### ✅ Week 4 Day 1 (2026-01-20): 實裝與測試
- [x] **將田中太郎重構版實裝到代碼**（P0 優先）✅ 完成
  - [x] 記憶即食材系統實作（~2500 行代碼）
  - [x] 話題選單系統實作（Postback 機制）
  - [x] 時段系統實作（Night→Day→Cooking→After）
  - [x] Day 1-3 完整流程實作
  - [x] 黑貓角色互動實作
- [x] 撰寫部署指南文檔
- [x] **部署到 GAS 進行真實環境測試** ✅ 完成
- [x] 發現並修正階段推進 Bug
- [x] UX 問題診斷與改進方案設計

### ✅ Week 4 Day 2 (2026-01-21): UX 優化完成
- [x] **P0：互動方式優化 + Loading Animation**（實際 4hr）
  - [x] Loading Animation 全面覆蓋（35 處）
  - [x] Message Action 導入（話題選擇）
  - [x] 修正 4 個關鍵 Bug
- [x] **P1：玩家輸入系統**（實際 2hr）
  - [x] 話題選擇改為 Message Action
  - [x] 創造左右交錯視覺節奏
  - [x] 提升帶入感
- [x] **Day 1 動態話題系統**（實際 3hr）✨ **重大突破**
  - [x] 多次對話收集食材系統
  - [x] 動態按鈕顯示（完成話題自動隱藏）
  - [x] 完成話題後回到選擇畫面
  - [x] 動態顯示廚房食材
  - [x] 大幅提升重玩價值與開放度

### 🔄 Week 4 Day 3+ (2026-01-21~): 動態系統擴展
- [x] **P0：Day 2-3 動態話題系統擴展**（預估 4-6hr）
  - [x] Day 2 改造為動態系統（3 個話題）
  - [x] Day 3 動態食材顯示
  - [x] 全面測試與優化
- [x] **P2：劇情分段呈現優化**（預估 2-3hr）
  - [x] Day 2「那個夢」已分段 ✅
  - [x] Day 1 其他話題分段優化
  - [x] Day 3 真相揭露分段

### Week 5+: 擴充與優化
- [ ] 根據測試結果優化機制
- [ ] 建立 Guest 2-3 劇本（使用田中太郎模板）
- [ ] 實作 LIFF 烹飪小遊戲原型（可選）
- [ ] 進行封閉測試（5-10 名玩家）

詳細任務: [[../../00-工作區/主 Backlog_2026-01-15|主 Backlog]]

---

## 🎯 成功指標

### 定性指標 (情感深度)
- 測試者是否在告別時感到「不捨但釋然」?
- 是否有測試者主動分享遺物卡片?
- 是否有「我想再見一次那位靈魂」的反饋?

### 定量指標 (留存與完成度)
- **誘捕 → 偵訊 完成率**: 目標 > 70%
- **偵訊 → 告別 完成率**: 目標 > 60%
- **完整通關率**: 目標 > 50%
- **平均標籤採集數**: 目標 ≥ 4 個
- **料理成功率**: 目標 > 80%

---

## 📚 相關資源

### 企劃與研究
- [[../../02-研究分析/靈魂食堂企劃重構|完整企劃重構文件]]
- [[企劃書與Bird Alone結合探討|Bird Alone 情感機制分析]]
- [[../../04-資源素材/技術成本_非即時制設計的優勢|非即時制設計哲學]]

### 技術實作
- [[專案實作對照表|敘事-代碼映射表]]
- [[程式碼.gs|當前代碼 (V1.4)]] - ⚠️ 需重構

### 決策追溯與後續規劃
- [[開發決策鏈|決策考古學]]
- [[../產品路線圖|產品路線圖]]（後續階段與時機）

### 驗證與問卷
- [[../../03-驗證流程/驗證流程總覽|驗證流程總覽]]
- [[../../03-驗證流程/封測問卷設計|封測問卷設計]]（題目與成功指標對照）

---

## 🔥 立即行動

**如果你是首次接觸本專案**, 請按此順序閱讀:
1. 本文件 (Overview)
2. [[../../02-研究分析/靈魂食堂企劃重構|企劃重構]] (世界觀與機制)
3. [[專案實作對照表|實作對照表]] (如何開發)

**如果你要繼續開發**, 請查看:
- [[主 Backlog_2026-01-15|主 Backlog]] (當前任務)
- [[架構診斷報告_2026-01-15|診斷報告]] (解決方案)

---

**專案信念**:

> 「在數據流中重構人性。」  
> 「見證,而非審判。」  
> 「溫暖,但具有重量。」

---

## 🎨 UX 設計原則（新增 2026-01-20）

### LINE 載體的原生體驗設計

**核心理念**：善用 LINE 聊天的獨特性，而非把它當成「網頁的替代品」

#### 原則 1：玩家輸入 = 玩家行動

**設計**：
- 凡是「我」（主廚）說的話，用「玩家訊息」（系統代發）
- 創造「玩家在說話」的錯覺

**好處**：
1. **帶入感**：綠色聊天框 = 我說的話，強化角色扮演
2. **視覺節奏**：左（系統敘事）右（玩家行動）交錯
3. **降低卡片長度**：對話可以拆出來

**範例**：
```
[玩家訊息] 你的手...是做什麼工作的？
[官方訊息] 【老人慢慢抬起手，盯著指尖】
[官方訊息] 「我的手...有很多小洞。」
```

#### 原則 2：立即反饋 > 精美卡片

**設計**：
- 卡片按鈕改為 Quick Reply 或 Message
- 點擊後立即顯示玩家訊息（0 延遲）
- 官方回應可以稍後生成

**好處**：
1. **消除等待感**：按了立即有反應
2. **更像真實對話**：訊息出現而非卡片出現
3. **降低焦慮感**：確認點擊成功

#### 原則 3：分段 = 呼吸感

**設計**：
- 長劇情用多條訊息分段呈現
- 創造「電影分鏡」感

**好處**：
1. **降低認知負荷**：一次只讀一小段
2. **創造節奏感**：訊息逐條出現
3. **情感醞釀**：停頓點讓情緒沉澱
4. **可以更細膩**：不怕內容長

**範例**：
```
[訊息 1] 【老人望向窗外，聲音很輕】
[訊息 2] 「我夢到...一個小女孩。」
[訊息 3] 「她笑起來...很甜。像蜜糖一樣甜。」
[Flex Card] 【記憶碎片閃現】
```

#### 原則 4：動態話題系統（2026-01-22 新增）✨

**設計**：
- 玩家可以多次選擇不同話題收集食材
- 完成的話題自動隱藏按鈕
- 完成任意話題後顯示「進入廚房」
- 廚房根據收集的食材動態顯示內容

**好處**：
1. **重玩價值提升**：可以嘗試不同話題組合
2. **開放度增加**：不再線性，更像開放世界
3. **收集樂趣**：多種食材組合可能性
4. **玩家主導**：自己決定何時進入廚房

**範例流程**：
```
Day Shift 10:00
    ├─ 你的手 → 獲得：針、縫線、寒冷
    ├─ 你從哪裡來 → 獲得：失憶、迷茫
    ├─ 窗外的雨 → 獲得：雨聲、潮濕
    └─ 沉默陪伴 → 獲得：寧靜、陪伴
         ↓
    完成話題後可隨時進入廚房
         ↓
Cooking Time（顯示所有收集的食材）
```

### UX 改進優先級

| 優先級 | 改進項目 | 預估工時 | 預期效果 | 狀態 |
|-------|---------|---------|---------|------|
| **P0** | Loading + Message Action | 2-3 小時 | 立即反饋，消除等待感 | ✅ 完成 |
| **P1** | 玩家輸入 = 玩家台詞 | 3-4 小時 | 帶入感提升 50% | ✅ 完成 |
| **P1+** | 動態話題系統（Day 1） | 3 小時 | 重玩價值質變 | ✅ 完成 |
| **P2** | 劇情分段呈現 | 4-6 小時 | 閱讀體驗質變 | ✅ 完成 |
| **P3** | Day 2-3 動態系統 | 4-6 小時 | 全面開放化 | ✅ 完成 |
| **P4** | 五味系統 + 結局變體 | 8 小時 | 重玩深度提升 | ✅ 完成（V4.4-V4.6）|
| **P5** | Rich Menu UX 系統 | 6 小時 | 圖鑑體驗完整化 | ✅ 完成（V4.8）|

---

## 🔮 未來規劃：LIFF 廚房小遊戲

> **狀態**：規劃中（MVP 完成後啟動）

### 設計概念

將廚房料理從「文字選擇」升級為「拖曳調配」的互動體驗，讓玩家**親手觸摸**記憶的重量與溫度。

### 核心設計

**記憶托盤 (The Palette)**
- 左側/下方顯示所有已收集的記憶 icon
- **關鍵設計**：記憶 icon 永久可用，不消耗
- 拖曳後 icon 閃爍表示「提取了這段記憶」

**靈魂之鍋 (The Pot)**
- 中央滾動的湯底
- 入鍋時發出「滋—」的聲音，冒出對應顏色的煙

**味道光譜 (The Spectrum)**
- 動態雷達圖顯示目前的五味傾向
- 實時反饋玩家的調配結果

### 玩法的樂趣

**挑戰是「調味」**：
- 觀察黑貓提示：「他現在太苦了，需要一點甜的」
- 嘗試不同記憶組合
- 直到調出「完美的平衡」

**樂趣是「實驗」**：
- 把所有苦的都丟進去 → 鍋子變深黑色
- 全放甜的 → 粉紅色
- 即時的視覺回饋本身就是樂趣

### 技術方案

- **平台**：LINE LIFF v2
- **前端**：HTML5 + CSS3 + Vanilla JS
- **後端**：Google Apps Script Web App API
- **數據流**：LIFF 讀取 userId → 調用 GAS API 獲取 userState → 實時計算五味

### 啟動條件

當滿足以下條件時，考慮開發 LIFF：
- [ ] 至少 50 名玩家完成 Guest 1 全流程
- [ ] 玩家反饋中超過 30% 提到「希望有更多互動」
- [ ] 已完成 Guest 2-3 的劇本開發

### 不在 MVP 範圍的原因

1. **開發成本**：前端網頁 + API 架設，約 2-3 週
2. **風險**：在驗證核心敘事前投入過多技術
3. **替代方案**：Flex Message 選單已足夠 MVP 驗證

---

### 🎮 LIFF 廚房小遊戲 MVP 版本（2026-02-03 新增，2026-02-05 完成）

> **狀態**：✅ 已完成（V4.13 API + V4.14 體驗優化）
> **定位**：簡化版，驗證「拖拉互動」核心體驗

#### MVP 與完整版的關係

此 MVP 版本是上述完整版的**簡化先行版**，用於封測前驗證核心體驗。完整版設計保留作為未來目標。

#### MVP 核心功能

| 功能 | MVP 版本 | 完整版（未來） |
|------|----------|----------------|
| 食材顯示 | 已收集的記憶 icon | 同左 |
| 互動方式 | 拖拉食材到鍋子 | 同左 |
| 黑貓反應 | 文字泡泡 | 文字 + 表情動畫 |
| 五味反饋 | 無（後端計算） | 實時雷達圖 |
| 聲音效果 | 無 | 入鍋音效 |
| 視覺效果 | 簡單入鍋動畫 | 顏色變化 + 煙霧 |

#### 黑貓反應設計

根據拖入的食材組合，顯示不同的文字泡泡：

| 情境 | 黑貓台詞 |
|------|----------|
| 第一個食材 | 「嗯...開始了。」 |
| 甜味食材 | 「甜甜的...是好的回憶嗎？」 |
| 苦味食材 | 「苦澀啊...有些事不能忘。」 |
| 辛味食材 | 「嗆...這是眼淚的味道。」 |
| 連續同味 | 「太多了...會失衡的。」 |
| 接近平衡 | 「差不多了...再想想。」 |

#### 技術架構（MVP）

```
LINE Chat → 點擊「開始料理」→ 打開 LIFF URL
                                    ↓
                             LIFF Web App
                             - liff.init()
                             - 取得 userId
                             - 調用 GAS API 取得食材
                             - 渲染拖拉介面
                             - 黑貓文字反應
                                    ↓
                             點擊「完成料理」
                             - 調用 GAS API 計算結局
                             - liff.sendMessages() 回傳結果
                             - liff.closeWindow()
```

#### 開發清單

- [x] LINE Developers Console 建立 LIFF App
- [x] 前端開發（`01-開發實驗/程式碼/liff-cooking/`）
- [x] GAS 後端 API（`doGet()` + `getCookingStateForLiff()` + `submitCookingFromLiff()`）
- [x] 整合到 Day 1/2/3 料理階段（含點擊料理修復、提示料理與食材）
- [x] 部署（GitHub Pages + GAS Web App）

---

## 📝 最新進展

### 📋 劇本擴增收尾與封測前排程（2026-02-08）⭐ 最新

**階段結案**:
1. ✅ **劇本擴增 V4.15 收尾** — P0（Day 2 After 三分支）、P1（Day 2→3 過渡段）、P2（老人 idle 行為）均已實作
2. ✅ **P3/P4 延後決策** — Day 2 觀察互動點、黑貓料理哲學台詞，延後至封測後依回饋再設計
3. ✅ **封測前待辦排程** — 問卷設計（告別支後）、加入好友後開場白（遊戲說明＋CTA）、LINE OA／LIFF 頭像更換
4. ✅ **文檔歸檔** — 刪除 擴增方向.md、談話.md

---

### 📐 V4.15 劇本擴充設計原則與 Skill（2026-02-06）

**完成事項**:
1. ✅ **劇本擴充設計三原則** — 以三個戰略目的篩選「該加／不該加」的擴充內容：
   - 目的一：解決認知斷層（Onboarding）— 世界觀、規則、身分動機
   - 目的二：調節體驗節奏（Pacing）— 呼吸點、情緒顆粒度
   - 目的三：驗證主動探索意願（Engagement）— 可選「聽更多」、可追蹤
2. ✅ **Skill 撰寫** — `.cursor/skills/script-expansion-principles/SKILL.md`，供擴充劇本或審核時 @ 使用
3. ✅ **決策**：V4.14 可開始測試；因故事厚度不足決定先擴充劇本再測
4. ✅ **程式**：對話表常數修正（DIALOGUE_SHEET_NAME 正確定義，與佈署說明對齊）

---

### 🎮 V4.14 LIFF 體驗優化（2026-02-05）

**完成事項**:
1. ✅ **修復：點擊料理沒反應** — 料理階段正確顯示 LIFF 按鈕並導向小遊戲
2. ✅ **MVP 擴增**：提示玩家要做的料理、需要什麼食材（availableRecipes、recipeRequirements）
3. ✅ **修復**：遺物圖鑑與突見（圖像）無法正確顯示（Flex + imageUrl、push）
4. ✅ **修復**：carousel 最後一張卡片尺寸以符合 LINE 規範
5. ✅ **Backlog**：GAS 後端 API 項確認完成（對應 V4.13 實作）

---

### 🎮 V4.13 LIFF 做飯小遊戲 MVP + 遺物圖片（2026-02-03）

**完成事項**:
1. ✅ **LIFF 做飯小遊戲 MVP**
   - 前端開發完成（`01-開發實驗/程式碼/liff-cooking/`）
   - GAS 後端 API（`getCookingStateForLiff`、`submitCookingFromLiff`）
   - 設定指南（[[SETUP]]）

2. ✅ **遺物圖片整合**
   - `heirloom_bitter_bent_needle.png` - 彎曲的縫紉針（苦味）
   - `heirloom_sweet_photo.png` - 泛黃的照片（甜味）
   - `heirloom_balanced_thimble.png` - 銀頂針（平衡）
   - `createHeirloomCard()` 支援圖片顯示

---

### 🎬 V4.12 Day 3 告別 Hero 圖 + LIFF MVP 規劃（2026-02-03）

**完成事項**:
1. ✅ **Day 3 告別場景 Hero 圖（3 張）**
   - `day3_farewell_bitter.png` - 苦味結局：老人背對婚紗離去
   - `day3_farewell_sweet.png` - 甜味結局：擁抱消融婚紗，仰望幻象太陽
   - `day3_farewell_balanced.png` - 平衡結局：女兒引領父親升天

2. ✅ **程式碼整合**
   - `getDay3Farewell()` 加入動態 Hero 圖（根據結局類型）
   - 緩存修復：`day1_memory_hands_needle.png`、`day2_memory_promise.png` URL 加 `?v=2`

3. ✅ **圖片去浮水印處理**
   - `day1_memory_hands_needle.png` - 重新生成
   - `day2_memory_promise.png` - 重新生成

4. 🔄 **LIFF 做飯小遊戲 MVP 規劃**
   - 設計決策完成（拖拉食材 + 黑貓文字反應）
   - 技術架構確定（LIFF v2 + GAS API）
   - 開發清單建立

**Hero 圖總計**：14 張（Day 1-2: 11 張 + Day 3: 3 張）

---

### 🎨 Hero 圖視覺系統建立（2026-02-01）

**完成事項**:
1. ✅ **Hero 圖整合（4 張 Day 1 場景）**
   - `opening_black_cat_hero.png` - 開場黑貓（哥德修道院/藍色爐火）
   - `day1_night_old_man_enters.png` - 老人進場（推門/雨夜/高對比）
   - `day1_memory_attic_tea.png` - 記憶劇場：深夜閣樓送茶
   - `day1_memory_empty_workshop.png` - 記憶劇場：空蕩的工房

2. ✅ **程式碼整合**
   - `getOpening()` - 黑貓 emoji 替換為 Hero 圖
   - `getDay1NightStart()` - Night Shift 標題替換為老人進場圖

3. ✅ **美術規範建立**
   - 確立 Hollow Knight / Alto's Odyssey 風格方向
   - 建立提示詞模板、檔名命名規則
   - 更新 [[../../04-資源素材/靈魂食堂_美術風格分析報告|美術風格分析報告]]

4. ✅ **AI Skill 開發**
   - 建立 `.cursor/skills/hero-image-generation/` 資料夾
   - 技術規範（風格定義、提示詞模板、程式碼整合模式）
   - 快速參考指南

**技術架構更新**:
- Git LFS 追蹤 PNG 檔案
- 圖片資產位於 `04-資源素材/圖片/遊戲素材/`

---

### 🎉 V4.10 Day 1-2 料理演出動態化（2026-01-30）

**完成事項**:
1. ✅ **統一「有啥食材顯示啥」設計原則**
   - 參考 Day 3 的動態顯示邏輯
   - 從玩家實際收集的記憶中，篩選出與該料理相關的記憶來顯示
   - 解決「看到自己沒收集的記憶」的困惑問題

2. ✅ **Day 1 熱茶演出動態化**
   - 根據實際收集的記憶動態顯示：針/縫線/寒冷/寧靜/陪伴
   - 不同記憶有不同視覺描述（藍色霧氣/銀色光芒/金色絲線/柔和暖光）

3. ✅ **Day 1 熱湯演出動態化**
   - 根據實際收集的記憶動態顯示：雨聲/失憶/迷茫
   - 只顯示玩家實際有的記憶

4. ✅ **Day 2 蜜汁燉菜演出動態化**
   - 移除錯誤的「寒冷」（不是必要食材）
   - 只顯示蜜糖笑容/眼淚

5. ✅ **Day 2 苦辛醒神湯演出動態化 + Flex Card**
   - 根據實際收集的記憶動態顯示：執念/雪/死亡
   - 記憶劇場改為 Flex Card（閣樓場景 + 雪中場景）

6. ✅ **新增「料理食譜系統」結構設計庫**
   - 位於企劃書「五-A」章節
   - 各階段料理對照表（解鎖條件 + 相關記憶池 + 實作函數）
   - 新增 Guest 時的檢查清單

**技術架構更新**:
- 修改函數：4 個（Day 1-2 料理相關）+ 4 個呼叫處
- 代碼行數：~6,050 行

---

### 🎉 V4.9 Day 3 動態料理系統（2026-01-29）

**完成事項**:
1. ✅ **Day 3 最終料理動態化**
   - 根據五味傾向動態決定料理名稱：
     - 🍬 甜味過重：糖霜幻景拼盤
     - 🦴 苦味過重：千針冷骨湯
     - 🐟 平衡：百味蜜汁炙燒魚
   - 只顯示玩家實際收集的食材
   - 按鈕文字動態化

2. ✅ **苦味結局真相獨白修正**
   - 核心概念：「做到了，卻沒有意義」（職人的徒勞）
   - 新版文本更貼近田中太郎的職人設定
   - 不是「做不到」，而是「做到了，卻沒有意義」

3. ✅ **Day 3 料理演出動態化**
   - `getDay3CookingProcess_Part1(state)` - 根據結局類型調整做菜演出
   - `getDay3CookingProcess_Part2(state)` - 根據結局類型調整完成文案
   - `getDay3CookingMemoryCard(state)` - 動態黑貓評論

4. ✅ **黑貓料理評論動態化**
   - 平衡：「甜的、鹹的、酸的、苦的...這條魚裡什麼都有。這就是人生吧？」
   - 苦味：「肉都沒了，只剩下骨頭和刺。喝下去就像吞針一樣...」
   - 甜味：「把所有甜的都拼在一起...再撒上糖粉...這是要騙誰呢？」

**技術架構更新**:
- 修改函數：6 個（Day 3 料理相關）
- 代碼行數：~5,900 行

---

### 🎉 V4.8 Rich Menu UX 系統完成（2026-01-28）

**完成事項**:
1. ✅ **Rich Menu 分級管制機制**
   - 沉浸破壞型（人物紀傳/遺物圖鑑）：遊戲進行中黑貓攔截
   - 工具輔助型（靈魂狀態/遊戲說明）：隨時可開
   - 解決「點圖鑑打斷遊戲沉浸感」的 UX 問題

2. ✅ **回程票系統 `restoreGameScreen()`**
   - 解決「Flex Card 洗版後選項消失」的 UX 問題
   - 查看圖鑑後點「回到遊戲」自動重印當前畫面
   - 根據 phase 智能判斷該顯示話題選單還是料理介面

3. ✅ **靈魂狀態面板**
   - 五味進度條視覺化（甜/酸/苦/辣/鹹）
   - 已收集記憶列表
   - 黑貓動態評論（根據五味傾向變化）

4. ✅ **LINE Official Account Manager 支援**
   - 新增 `/menu` 文字指令（bio/heirloom/status/help）
   - 相容 Postback 與 Message 兩種 Rich Menu 設定方式

**技術架構更新**:
- 新增函數：12 個（Rich Menu 處理 + 狀態面板 + 回程票）
- 代碼行數：~5,785 行

---

### 🎉 V4.7 敘事修復與圖鑑系統（2026-01-28）

**完成事項**:
1. ✅ **結局敘事修復**
   - 新增 `getTruthMonologue(endingType)` - 三種結局各有不同的真相揭露過程
   - 修復甜味結局「大徹大悟後又裝睡」的敘事割裂問題

2. ✅ **lifetimeHeirlooms 永久遺物系統**
   - 新增 H 欄 JSON 欄位，跨輪次保留已獲得的遺物
   - 遺物採用策略 A（覆蓋制）：同類型結局顯示最新變體描述
   - 支援遺物圖鑑跨周目累積收集

---

### 🎉 V4.6 結局變體系統（2026-01-27）

**完成事項**:
1. ✅ **結局名稱動態化**（18 種）
   - 3 預設 + 4 變體 × 3 結局 + 全收集 × 3
   
2. ✅ **黑貓評論動態化**（18 種）
   - 觀眾代言人式評論，根據變體記憶變化
   
3. ✅ **遺物描述動態化**（18 種）
   - 根據收集的變體記憶生成不同描述

4. ✅ **告別對話模組化堆疊**
   - 開頭骨架 + 變體層/全收集專屬 + 結尾骨架
   - 全收集專屬設計（變體記憶 >= 3 時觸發）

---

### 🎉 V4.5 劇本昇華三痛點（2026-01-26）

**完成事項**:
1. ✅ **翻譯者概念**：撫慰鹹粥增強（雪子作為溝通介面）
2. ✅ **裂痕事件**：Day 2 延伸話題 `ceremony_rift`（缺席的典禮）
3. ✅ **時代孤獨**：Day 1 延伸話題 `twilight_artisan`（空蕩的店）
4. ✅ 新增 3 個記憶標籤：`失語`、`缺席的典禮`、`空蕩的店`

---

### 🎉 V4.4 五味系統完整實作（2026-01-25）

**完成事項**:
1. ✅ **`MEMORY_FLAVOR_MAP`** 完整配置（20+ 記憶標籤）
2. ✅ **`calculateFlavorBalance()`** 函數實作
3. ✅ **`determineEnding()`** 結局判定邏輯
4. ✅ 三種結局：甜味過重 / 苦味過重 / 平衡
5. ✅ 縱向延伸話題系統（Day 1-2 深化對話）

---

### Week 4 Day 2 重大突破（2026-01-21）

**完成事項**:
1. ✅ **Loading Animation 全面覆蓋**
   - 修正 LINE API 格式（loadingSeconds 必須是 5 的倍數）
   - 所有 input 加入 Loading Animation（35 處）
   - 消除等待感，提升體驗

2. ✅ **關鍵 Bug 修正**
   - 觀察他沒有 Loading → 已修正
   - 話題選擇沒有對話形式 → 改用 Message Action
   - 進入廚房條件過嚴 → 已放寬
   - 做熱茶卡住 → 修正訊息數量限制

3. ✅ **Day 1 動態話題系統**（重大突破 ✨）
   - 多次對話收集食材機制
   - 動態按鈕顯示（完成話題自動隱藏）
   - 完成話題後回到選擇畫面
   - 動態顯示廚房食材
   - 4 個話題可選擇：你的手、你從哪裡來、窗外的雨、沉默陪伴
   - 大幅提升重玩價值與開放度

**技術架構更新**:
- 代碼行數：~3,488 行（+300 行）
- 新增動態函數：`getDay1DayShift(state)`, `getDay1CookingScene(state)`
- 新增 3 個話題支線（每個話題獲得不同食材）

**下一步**: 擴展到 Day 2-3，完成全面動態化

### 🎉 Week 4 Day 1 重大突破（2026-01-20）

**完成事項**:
1. ✅ **田中太郎重構版代碼實作完成**
   - 完整可部署代碼：~1200 行
   - Day 1-3 全流程實作完成
   - 時段系統：Night → Day → Cooking → After Hours
   - 記憶即食材系統完整實作
   - 話題選單系統（Postback 機制）
   - 黑貓角色全程互動

2. ✅ **部署指南文檔完成**
   - 詳細部署步驟
   - 測試流程說明
   - 與畫鬼腳 MVP 的差異對照
   - 常見問題 FAQ

3. ✅ **技術架構確定**
   - 選定方案 A：基於畫鬼腳 MVP v1.0 擴展
   - 6 欄位數據結構（簡化版）
   - Sheet 名稱：`userStateTanaka`

### Week 3 重大里程碑（2026-01-15~19）

1. ✅ 畫鬼腳 MVP 部署成功（1/18）
2. ✅ 田中太郎劇本深化完成（1/19）
   - 兩個完整版本（MVP擴充版、重構版）
   - 記憶即食材系統設計
   - 儀式化循環結構
   - 台詞生動化全面調整（1712行）
3. ✅ 所有核心設計決策完成

### 關鍵文件更新

| 文件 | 最新版本 | 更新內容 |
|------|---------|---------|
| 田中太郎代碼 | V4.15 | 劇本擴充設計討論；對話表常數修正 |
| 部署指南 | V4.8 | Rich Menu 設定指南 + LIFF 未來規劃 |
| 田中太郎劇本 | MVP v3.0 重構版 | 1713行完整劇本 + 台詞優化 |
| 工作報告 | 2026-02-06 | 劇本擴充設計原則與 Skill |
| 本企劃書 | V4.15 | 劇本擴充設計三原則與 Skill 建立 |

### 專案檔案位置

- **代碼**: `01-開發實驗/程式碼/靈魂食堂_田中太郎_五味料理版.gs`
- **部署指南**: `01-開發實驗/程式碼/部署與開發指南.md`
- **劇本**: `02-劇本設計/Guest1_田中太郎_重構版_神秘感優先.md`
- **工作報告**: `00-工作區/archive-2026-02/工作報告_2026-02-06_劇本擴充設計原則與Skill.md`

---

**文件狀態**: 🟢 Active  
**最後更新**: 2026-02-06  
**維護者**: 專案負責人  
**下次回顧**: 劇本擴充完成後、全面測試前

